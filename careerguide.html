<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CareerGuide AI - Personalized Career Guidance</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary-color: #0a0f1e;   /* Premium Dark Blue */
            --secondary-color: #1a243d; /* Rich Navy */
            --accent-color: #4a9dff;    /* Professional Blue */
            --accent-light: #7ab6ff;    /* Light Blue */
            --text-color: #e8eef7;
            --text-secondary: #b8c2d9;
            --bg-color: #0d1425;
            --card-bg: #151e33;
            --input-bg: #1c2845;
            --border-color: #2a3755;
            --shadow-color: rgba(0, 0, 0, 0.3);
            --header-bg: rgba(13, 20, 37, 0.95);
            --message-user-bg: #1a2840;
            --message-bot-bg: #1e2c47;
            --message-user-text: #e8eef7;
            --message-bot-text: #e8eef7;
            --header-height: 49px;
        }

        body.dark-mode {
            --primary-color: #0a0f1e;
            --secondary-color: #1a243d;
            --accent-color: #4a9dff;
            --accent-light: #7ab6ff;
            --text-color: #e8eef7;
            --text-secondary: #b8c2d9;
            --bg-color: #0d1425;
            --card-bg: #151e33;
            --input-bg: #1c2845;
            --border-color: #2a3755;
            --shadow-color: rgba(0, 0, 0, 0.5);
            --header-bg: rgba(13, 20, 37, 0.95);
            --message-user-bg: #1a2840;
            --message-bot-bg: #1e2c47;
            --message-user-text: #e8eef7;
            --message-bot-text: #e8eef7;
        }

        body {
            height: 100vh;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: var(--text-color);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: background 0.3s, color 0.3s;
        }

        /* Header styling */
        .main-header {
            background: var(--header-bg);
            padding: 8px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 15px var(--shadow-color);
            transition: background 0.3s, box-shadow 0.3s;
            height: var(--header-height);
            min-height: var(--header-height);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(74, 157, 255, 0.2);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-icon {
            background: linear-gradient(135deg, var(--accent-color), var(--accent-light));
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
            font-size: 1rem;
        }

        .logo-text {
            font-weight: bold;
            font-size: 1.4rem;
            background: linear-gradient(to right, var(--accent-color), var(--accent-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0px 2px 3px var(--shadow-color);
            letter-spacing: -0.5px;
        }

        .career-part {
            color: var(--accent-color);
            font-weight: 800;
        }

        .ai-part {
            color: var(--accent-light);
            font-weight: 800;
        }

        .header-controls {
            display: flex;
            gap: 10px;
        }

        .header-controls button {
            background: rgba(74, 157, 255, 0.1);
            color: var(--accent-color);
            border: 1px solid rgba(74, 157, 255, 0.3);
            padding: 6px 12px;
            border-radius: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: background 0.3s, transform 0.2s;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .header-controls button:hover {
            background: rgba(74, 157, 255, 0.2);
            transform: translateY(-1px);
        }

        /* Chat area styling */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            margin: 15px;
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 8px 25px var(--shadow-color);
            overflow: hidden;
            transition: background 0.3s, box-shadow 0.3s;
            max-width: 1200px;
            width: 95%;
            align-self: center;
            border: 1px solid rgba(74, 157, 255, 0.1);
        }

        .chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
            background: var(--bg-color);
            transition: background 0.3s;
        }

        .message {
            max-width: 80%;
            padding: 10px 14px;
            border-radius: 16px;
            line-height: 1.4;
            animation: fadeIn 0.3s ease;
            box-shadow: 0 2px 8px var(--shadow-color);
            font-size: 0.85rem;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .bot-message {
            align-self: flex-start;
            background: var(--message-bot-bg);
            border-bottom-left-radius: 5px;
            color: var(--message-bot-text);
            transition: background 0.3s, color 0.3s;
            border-left: 2px solid var(--accent-color);
        }

        .user-message {
            align-self: flex-end;
            background: var(--message-user-bg);
            color: var(--message-user-text);
            border-bottom-right-radius: 5px;
            border-right: 2px solid var(--accent-color);
        }

        .message-content {
            margin-bottom: 5px;
        }

        .timestamp {
            font-size: 0.65rem;
            text-align: right;
            margin-top: 5px;
            opacity: 0.7;
            color: var(--text-secondary);
        }

        .chat-input-container {
            display: flex;
            flex-direction: column;
            padding: 12px;
            background: var(--card-bg);
            border-top: 1px solid var(--border-color);
            gap: 10px;
            transition: background 0.3s, border-color 0.3s;
        }

        .input-row {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
        }

        .chat-input {
            flex: 1;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .chat-input input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 24px;
            outline: none;
            font-size: 0.85rem;
            transition: border-color 0.3s;
            background: var(--input-bg);
            color: var(--text-color);
        }

        .chat-input input:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px rgba(74, 157, 255, 0.2);
        }

        .send-button {
            background: var(--accent-color);
            color: var(--primary-color);
            border: none;
            width: 42px;
            height: 42px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background 0.3s, transform 0.2s;
            flex-shrink: 0;
            font-weight: bold;
        }

        .send-button:hover {
            background: var(--accent-light);
            transform: scale(1.05);
        }

        .send-button:disabled {
            background: #555;
            cursor: not-allowed;
            transform: none;
        }

        .typing-indicator {
            display: flex;
            padding: 10px;
            gap: 5px;
            align-self: flex-start;
        }

        .typing-dot {
            width: 7px;
            height: 7px;
            background: var(--accent-color);
            border-radius: 50%;
            opacity: 0.6;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typingAnimation {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.6;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }

        /* Suggestion chips styling */
        .suggestion-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
            margin-bottom: 5px;
        }

        .suggestion-chip {
            background: rgba(74, 157, 255, 0.1);
            border: 1px solid rgba(74, 157, 255, 0.3);
            border-radius: 14px;
            padding: 6px 10px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--accent-color);
        }

        .suggestion-chip:hover {
            background: rgba(74, 157, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        /* Program buttons styling */
        .program-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .program-button {
            background: rgba(74, 157, 255, 0.1);
            color: var(--accent-color);
            border: 1px solid rgba(74, 157, 255, 0.3);
            border-radius: 16px;
            padding: 8px 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: 500;
            font-size: 0.8rem;
        }

        .program-button:hover {
            background: rgba(74, 157, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px var(--shadow-color);
        }

        /* Footer with usage tips */
        .chat-footer {
            padding: 10px;
            text-align: center;
            background: var(--bg-color);
            border-top: 1px solid var(--border-color);
            font-size: 0.7rem;
            color: var(--text-secondary);
            transition: background 0.3s, border-color 0.3s;
        }

        /* Info Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 100;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
            color: var(--text-color);
            transition: background 0.3s, color 0.3s;
            border: 1px solid rgba(74, 157, 255, 0.1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-header h2 {
            color: var(--accent-color);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3rem;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
            transition: color 0.3s;
        }

        .close-modal:hover {
            color: var(--accent-color);
        }

        .config-group {
            margin-bottom: 15px;
            font-size: 0.85rem;
        }

        .config-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--text-color);
        }

        .model-info {
            background: rgba(74, 157, 255, 0.1);
            padding: 10px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 0.8rem;
            color: var(--text-color);
            border-left: 3px solid var(--accent-color);
        }

        .info-badge {
            background: rgba(74, 157, 255, 0.1);
            border-radius: 4px;
            padding: 3px 6px;
            font-size: 0.65rem;
            color: var(--accent-color);
            margin-top: 5px;
            display: inline-block;
            border: 1px solid rgba(74, 157, 255, 0.2);
        }
        
        .source-indicator {
            font-size: 0.65rem;
            color: var(--text-secondary);
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Student info form styling */
        .student-form {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            margin: 15px;
            box-shadow: 0 4px 15px var(--shadow-color);
            border: 1px solid var(--border-color);
            max-width: 600px;
            width: 95%;
            align-self: center;
        }

        .form-title {
            text-align: center;
            margin-bottom: 20px;
            color: var(--accent-color);
            font-size: 1.4rem;
            font-weight: 600;
        }

        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-color);
            font-size: 0.85rem;
        }

        .form-group input, .form-group select {
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--input-bg);
            color: var(--text-color);
            font-size: 0.85rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
            border-color: var(--accent-color);
            outline: none;
            box-shadow: 0 0 0 2px rgba(74, 157, 255, 0.2);
        }

        .submit-btn {
            background: var(--accent-color);
            color: var(--primary-color);
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: background 0.3s, transform 0.2s;
            display: block;
            width: 100%;
            margin-top: 10px;
        }

        .submit-btn:hover {
            background: var(--accent-light);
            transform: translateY(-2px);
        }

        /* Dark mode toggle */
        .dark-mode-toggle {
            position: relative;
            width: 56px;
            height: 28px;
            background: var(--border-color);
            border-radius: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            padding: 0 5px;
            transition: background 0.3s;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        .dark-mode-toggle.active {
            background: var(--accent-color);
        }

        .dark-mode-toggle::before {
            content: '';
            position: absolute;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: white;
            transition: transform 0.3s;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        .dark-mode-toggle.active::before {
            transform: translateX(28px);
        }

        .dark-mode-toggle i {
            font-size: 0.7rem;
            z-index: 1;
        }

        .dark-mode-toggle .fa-moon {
            color: white;
            margin-right: auto;
        }

        .dark-mode-toggle .fa-sun {
            color: #f39c12;
            margin-left: auto;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .main-header {
                padding: 6px 12px;
            }
            
            .logo-text {
                font-size: 1.1rem;
            }
            
            .header-controls button span {
                display: none;
            }
            
            .header-controls button {
                padding: 5px 8px;
            }
            
            .chat-container, .student-form {
                margin: 10px;
                width: calc(100% - 20px);
            }
            
            .message {
                max-width: 90%;
                font-size: 0.8rem;
            }
            
            .send-button {
                width: 40px;
                height: 40px;
            }
            
            .input-row {
                flex-wrap: wrap;
            }
            
            .chat-input {
                width: 100%;
            }
            
            .form-row {
                flex-direction: column;
                gap: 10px;
            }
        }

        @media (max-width: 480px) {
            .chat-messages {
                padding: 12px;
            }
            
            .message {
                padding: 8px 12px;
                font-size: 0.8rem;
            }
            
            .modal-content {
                padding: 20px;
            }
            
            .chat-input-container {
                padding: 10px;
            }
            
            .chat-input input {
                padding: 10px 14px;
                font-size: 0.8rem;
            }
            
            .student-form {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Main header with logo and controls -->
    <div class="main-header">
        <div class="logo">
            <div class="logo-icon">
                <i class="fas fa-graduation-cap"></i>
            </div>
            <h1 class="logo-text"><span class="career-part">CareerGuide</span> <span class="ai-part">AI</span></h1>
        </div>
        <div class="header-controls">
            <div class="dark-mode-toggle" id="dark-mode-toggle">
                <i class="fas fa-moon"></i>
                <i class="fas fa-sun"></i>
            </div>
            <button id="clear-chat-btn">
                <i class="fas fa-broom"></i>
                <span>Clear</span>
            </button>
            <button id="info-btn" title="About">
                <i class="fas fa-info-circle"></i>
                <span>About</span>
            </button>
        </div>
    </div>

    <!-- Student Information Form -->
    <div class="student-form" id="student-form">
        <h2 class="form-title">Student Information</h2>
        <form id="student-info-form">
            <div class="form-row">
                <div class="form-group">
                    <label for="student-name">Full Name</label>
                    <input type="text" id="student-name" placeholder="Enter your full name" required>
                </div>
                <div class="form-group">
                    <label for="student-mobile">Mobile Number</label>
                    <input type="tel" id="student-mobile" placeholder="Enter your mobile number" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="student-class">Class/Grade</label>
                    <select id="student-class" required>
                        <option value="">Select your class</option>
                        <option value="8th">8th Grade</option>
                        <option value="9th">9th Grade</option>
                        <option value="10th">10th Grade</option>
                        <option value="11th">11th Grade</option>
                        <option value="12th">12th Grade</option>
                        <option value="undergraduate">Undergraduate</option>
                        <option value="graduate">Graduate</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="student-aspiration">Career Aspiration</label>
                    <input type="text" id="student-aspiration" placeholder="What do you want to become?" required>
                </div>
            </div>
            <button type="submit" class="submit-btn">Get Career Guidance</button>
        </form>
    </div>

    <!-- Chat container -->
    <div class="chat-container" id="chat-container" style="display: none;">
        <div class="chat-messages" id="chat-messages">
            <!-- Messages will be dynamically added here -->
        </div>
        
        <div class="chat-input-container">
            <div class="input-row">
                <div class="chat-input">
                    <input type="text" id="user-input" placeholder="Ask me anything about career guidance...">
                    <button class="send-button" id="send-btn">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>

        <div class="chat-footer">
            <p>Tip: Ask about career paths, required skills, educational requirements, job prospects, and more</p>
            <p>Â© 2025 Powered By NexGenAiTech</p>
        </div>
    </div>

    <!-- Info Modal -->
    <div class="modal" id="info-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-info-circle"></i> About CareerGuide AI</h2>
                <button class="close-modal">&times;</button>
            </div>
            
            <div class="config-group">
                <p>CareerGuide AI (Powered By NexGenAiTech) is an advanced career counseling platform that helps students make informed decisions about their future careers.</p>
                
                <div class="model-info">
                    <p><strong>How It Works:</strong></p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>Provide your basic information and career aspirations</li>
                        <li>Receive personalized career guidance based on your profile</li>
                        <li>Get information about educational paths, required skills, and job prospects</li>
                        <li>Explore alternative career options based on your interests</li>
                        <li>Ask specific questions about any career field</li>
                    </ul>
                </div>
                
                <p style="margin-top: 15px;">Our AI-powered system analyzes your profile against current job market trends to provide the most relevant career advice.</p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const studentForm = document.getElementById('student-form');
            const chatContainer = document.getElementById('chat-container');
            const studentInfoForm = document.getElementById('student-info-form');
            const chatMessages = document.getElementById('chat-messages');
            const userInput = document.getElementById('user-input');
            const sendButton = document.getElementById('send-btn');
            const clearChatBtn = document.getElementById('clear-chat-btn');
            const infoBtn = document.getElementById('info-btn');
            const infoModal = document.getElementById('info-modal');
            const closeModalButtons = document.querySelectorAll('.close-modal');
            const darkModeToggle = document.getElementById('dark-mode-toggle');
            
            // Updated configuration with new model
            const apiKey = "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";
            const currentModel = "google/gemma-2-9b-it:free"; // Free and fast model
            const temperature = 0.7;
            const maxTokens = 800;
            
            let studentProfile = null;
            let defaultQuestionsProcessed = false;
            
            // Check for saved dark mode preference
            if (localStorage.getItem('darkMode') === 'enabled') {
                document.body.classList.add('dark-mode');
                darkModeToggle.classList.add('active');
            }
            
            // Dark mode toggle functionality
            darkModeToggle.addEventListener('click', function() {
                document.body.classList.toggle('dark-mode');
                darkModeToggle.classList.toggle('active');
                
                // Save preference
                if (document.body.classList.contains('dark-mode')) {
                    localStorage.setItem('darkMode', 'enabled');
                } else {
                    localStorage.setItem('darkMode', 'disabled');
                }
            });
            
            // Modal functionality
            infoBtn.addEventListener('click', function() {
                infoModal.style.display = 'flex';
            });
            
            closeModalButtons.forEach(button => {
                button.addEventListener('click', function() {
                    infoModal.style.display = 'none';
                });
            });
            
            // Close modal when clicking outside
            window.addEventListener('click', function(event) {
                if (event.target === infoModal) {
                    infoModal.style.display = 'none';
                }
            });
            
            // Student form submission
            studentInfoForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                // Get form values
                const name = document.getElementById('student-name').value;
                const mobile = document.getElementById('student-mobile').value;
                const studentClass = document.getElementById('student-class').value;
                const aspiration = document.getElementById('student-aspiration').value;
                
                // Store student profile
                studentProfile = {
                    name: name,
                    mobile: mobile,
                    class: studentClass,
                    aspiration: aspiration
                };
                
                // Hide form and show chat
                studentForm.style.display = 'none';
                chatContainer.style.display = 'flex';
                
                // Add welcome message
                addWelcomeMessage();
                
                // Process default questions with API
                await processDefaultQuestions();
                
                // Focus input
                userInput.focus();
            });
            
            // Manual focus when user clicks on input
            userInput.addEventListener('click', function() {
                userInput.focus();
            });
            
            // Add event listeners
            sendButton.addEventListener('click', function() {
                userInput.focus(); // Focus when send button is clicked
                sendMessage();
            });
            
            // Send message on Enter key (but allow Shift+Enter for new line)
            userInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            // Clear chat button
            clearChatBtn.addEventListener('click', function() {
                if (confirm('Are you sure you want to clear the conversation?')) {
                    chatMessages.innerHTML = '';
                    addMessage('Conversation cleared. How can I help you with your career guidance today? ðŸ˜Š', 'bot');
                    // Add suggestion chips again after clearing
                    setTimeout(addSuggestionChips, 100);
                }
            });
            
            // Suggestion chip functionality
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('suggestion-chip')) {
                    const question = e.target.getAttribute('data-question');
                    userInput.value = question;
                    userInput.focus(); // Focus when suggestion is clicked
                    sendMessage();
                }
            });
            
            // Function to add welcome message
            function addWelcomeMessage() {
                const welcomeMessage = `Hello ${studentProfile.name}! ðŸ‘‹ I'm your CareerGuide AI Assistant, and I'm excited to help you explore your career path to becoming a ${studentProfile.aspiration}. ðŸ˜Š

Based on your current class (${studentProfile.class}), I'll provide personalized guidance on:

ðŸŽ“ <strong>Educational Path:</strong> What subjects to focus on and the best courses to pursue
ðŸ’¼ <strong>Skills Development:</strong> Key skills you'll need for this career
ðŸ“ˆ <strong>Job Prospects:</strong> Future opportunities and growth in this field
ðŸ”„ <strong>Alternative Options:</strong> Related careers you might also enjoy
ðŸ“š <strong>Preparation Tips:</strong> How to best prepare while still in school

Let me analyze your profile and provide detailed answers to these key questions...`;

                addMessage(welcomeMessage, 'bot');
            }
            
            // Function to process default questions with API
            async function processDefaultQuestions() {
                if (defaultQuestionsProcessed) return;
                
                defaultQuestionsProcessed = true;
                
                const defaultQuestions = [
                    `What education is needed for ${studentProfile.aspiration}?`,
                    `What skills are important for ${studentProfile.aspiration}?`,
                    `What is the job market like for ${studentProfile.aspiration}?`,
                    `What are similar careers to ${studentProfile.aspiration}?`
                ];
                
                // Show typing indicator for the first question
                showTypingIndicator();
                
                for (let i = 0; i < defaultQuestions.length; i++) {
                    // Remove previous typing indicator
                    removeTypingIndicator();
                    
                    // Add the question as user message
                    addMessage(defaultQuestions[i], 'user');
                    
                    // Show typing indicator for response
                    showTypingIndicator();
                    
                    try {
                        // Process the question with API
                        const response = await getContextualAIResponse(defaultQuestions[i], studentProfile);
                        removeTypingIndicator();
                        
                        // Add the response with proper formatting
                        addMessage(response, 'bot');
                        
                        // Add a small delay between questions for better UX
                        if (i < defaultQuestions.length - 1) {
                            await new Promise(resolve => setTimeout(resolve, 1000));
                        }
                    } catch (error) {
                        console.error('Error processing default question:', error);
                        removeTypingIndicator();
                        addMessage('I encountered an error while processing this question. Please try again later.', 'bot');
                    }
                }
                
                // Add suggestion chips after all default questions are processed
                setTimeout(addSuggestionChips, 100);
            }
            
            // Function to add suggestion chips
            function addSuggestionChips() {
                const suggestionChips = document.createElement('div');
                suggestionChips.classList.add('suggestion-chips');
                
                const questions = [
                    `Can you provide more details about the education path?`,
                    `What are the day-to-day responsibilities?`,
                    `What is the earning potential?`,
                    `How can I start preparing right now?`
                ];
                
                questions.forEach(question => {
                    const chip = document.createElement('div');
                    chip.classList.add('suggestion-chip');
                    chip.setAttribute('data-question', question);
                    chip.textContent = question;
                    suggestionChips.appendChild(chip);
                });
                
                // Add to the last bot message
                const lastMessage = chatMessages.lastElementChild;
                if (lastMessage && lastMessage.classList.contains('bot-message')) {
                    lastMessage.querySelector('.message-content').appendChild(suggestionChips);
                }
            }
            
            // Function to add career field buttons
            function addCareerFieldButtons() {
                const careerButtons = document.createElement('div');
                careerButtons.classList.add('program-buttons');
                
                const careerFields = [
                    { text: "Technology", question: "Tell me about careers in technology" },
                    { text: "Medicine", question: "What are the career options in medicine?" },
                    { text: "Engineering", question: "Explain different engineering careers" },
                    { text: "Business", question: "What business careers are available?" },
                    { text: "Arts", question: "What are career options in arts?" },
                    { text: "Science", question: "Tell me about science careers" }
                ];
                
                careerFields.forEach(career => {
                    const button = document.createElement('button');
                    button.classList.add('program-button');
                    button.setAttribute('data-question', career.question);
                    button.innerHTML = `<i class="fas fa-arrow-right"></i> ${career.text}`;
                    careerButtons.appendChild(button);
                    
                    // Add click event
                    button.addEventListener('click', function() {
                        userInput.value = career.question;
                        userInput.focus(); // Focus when career button is clicked
                        sendMessage();
                    });
                });
                
                // Add to the last bot message
                const lastMessage = chatMessages.lastElementChild;
                if (lastMessage && lastMessage.classList.contains('bot-message')) {
                    lastMessage.querySelector('.message-content').appendChild(careerButtons);
                }
            }
            
            // Enhanced algorithm for question processing
            async function processQuestion(message) {
                // Always use API for career guidance questions
                try {
                    const apiResponse = await getContextualAIResponse(message, studentProfile);
                    return { finalResponse: apiResponse, source: "api" };
                } catch (error) {
                    console.error('API Error:', error);
                    // Fallback to basic response
                    return { finalResponse: "I'm having trouble accessing my career database right now. Please try again in a moment.", source: "error" };
                }
            }
            
            // Contextual API call with career-focused system message
            async function getContextualAIResponse(message, studentProfile) {
                // Enhanced system message to focus on career guidance
                const systemMessage = `You are a helpful AI career counselor for CareerGuide AI, a platform that provides personalized career guidance to students.

Important guidelines:
1. Provide accurate, helpful career guidance based on the student's profile and questions.
2. The student is ${studentProfile.name}, currently in ${studentProfile.class}, and wants to become a ${studentProfile.aspiration}.
3. Always provide practical, actionable advice that students can use.
4. Be encouraging and supportive in your responses.
5. When discussing careers, include information about:
   - Educational requirements and paths
   - Necessary skills and how to develop them
   - Job market outlook and opportunities
   - Potential challenges and how to overcome them
   - Alternative or related career options
6. Format your response with clear paragraphs, proper spacing, and use bullet points or numbered lists when appropriate.
7. Use emojis sparingly to make the conversation more engaging (maximum 2-3 per response).
8. Always maintain a professional yet friendly tone.
9. Make sure your response is well-structured with clear headings or sections when discussing multiple aspects.
10. End responses with a question or suggestion to keep the conversation flowing when appropriate.

Please provide detailed, well-formatted responses that are easy to read with proper paragraph breaks.`;

                // Create user message with student profile context
                const userMessageWithContext = `Student Profile:
- Name: ${studentProfile.name}
- Class: ${studentProfile.class}
- Career Aspiration: ${studentProfile.aspiration}

Question: ${message}`;

                const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`,
                        'HTTP-Referer': 'https://careerguideai.com',
                        'X-Title': 'CareerGuide AI Assistant'
                    },
                    body: JSON.stringify({
                        model: currentModel,
                        messages: [
                            { role: 'system', content: systemMessage },
                            { role: 'user', content: userMessageWithContext }
                        ],
                        temperature: temperature,
                        max_tokens: maxTokens
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }
                
                const data = await response.json();
                return data.choices[0].message.content;
            }
            
            // Function to send a message
            async function sendMessage() {
                const message = userInput.value.trim();
                
                if (message === '') return;
                
                // Add user message to chat
                addMessage(message, 'user');
                
                // Clear input and disable send button
                userInput.value = '';
                sendButton.disabled = true;
                
                // Show typing indicator
                showTypingIndicator();
                
                try {
                    // Use the enhanced processing algorithm
                    const response = await processQuestion(message);
                    removeTypingIndicator();
                    addMessage(response.finalResponse, 'bot');
                    
                    // Add appropriate badge based on source
                    if (response.source === "api") {
                        addInfoBadge("From NexGenAiTech AI");
                    }
                    
                    // If the message is about career fields, add career buttons
                    if (message.toLowerCase().includes('career') || 
                        message.toLowerCase().includes('field') ||
                        message.toLowerCase().includes('option')) {
                        setTimeout(addCareerFieldButtons, 100);
                    }
                    
                    // Add suggestion chips after response
                    setTimeout(addSuggestionChips, 100);
                } catch (error) {
                    console.error('Error:', error);
                    removeTypingIndicator();
                    addMessage('Oops! Something went wrong. Please try again. ðŸ”„', 'bot');
                } finally {
                    sendButton.disabled = false;
                }
            }
            
            // Function to add info badge
            function addInfoBadge(text) {
                const badge = document.createElement('div');
                badge.classList.add('info-badge');
                badge.textContent = text;
                
                const lastMessage = chatMessages.lastElementChild;
                if (lastMessage && lastMessage.classList.contains('bot-message')) {
                    lastMessage.appendChild(badge);
                }
            }
            
            // Function to add a message to the chat
            function addMessage(text, sender) {
                const messageElement = document.createElement('div');
                messageElement.classList.add('message');
                messageElement.classList.add(sender + '-message');
                
                const messageContent = document.createElement('div');
                messageContent.classList.add('message-content');
                
                // Handle text if present
                if (text && text.trim() !== '') {
                    // Process the text to maintain formatting
                    const formattedText = formatResponseText(text);
                    messageContent.innerHTML = formattedText;
                }
                
                const timestamp = document.createElement('div');
                timestamp.classList.add('timestamp');
                timestamp.textContent = getCurrentTime();
                
                messageElement.appendChild(messageContent);
                messageElement.appendChild(timestamp);
                
                chatMessages.appendChild(messageElement);
                
                // Scroll to bottom
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            // Function to format API response text with proper spacing
            function formatResponseText(text) {
                // Replace multiple newlines with paragraph breaks
                let formattedText = text.replace(/\n\s*\n/g, '</p><p>');
                
                // Replace single newlines with line breaks
                formattedText = formattedText.replace(/\n/g, '<br>');
                
                // Wrap in paragraph tags if not already wrapped
                if (!formattedText.startsWith('<p>') && !formattedText.startsWith('<ul>') && !formattedText.startsWith('<ol>')) {
                    formattedText = '<p>' + formattedText + '</p>';
                }
                
                // Ensure proper spacing between paragraphs
                formattedText = formattedText.replace(/<\/p><p>/g, '</p><p style="margin-top: 10px;">');
                
                return formattedText;
            }
            
            // Function to show typing indicator
            function showTypingIndicator() {
                const typingElement = document.createElement('div');
                typingElement.classList.add('typing-indicator');
                typingElement.id = 'typing-indicator';
                
                for (let i = 0; i < 3; i++) {
                    const dot = document.createElement('div');
                    dot.classList.add('typing-dot');
                    typingElement.appendChild(dot);
                }
                
                chatMessages.appendChild(typingElement);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            // Function to remove typing indicator
            function removeTypingIndicator() {
                const typingElement = document.getElementById('typing-indicator');
                if (typingElement) {
                    typingElement.remove();
                }
            }
            
            // Function to get current time in HH:MM format
            function getCurrentTime() {
                const now = new Date();
                return now.getHours().toString().padStart(2, '0') + ':' + 
                       now.getMinutes().toString().padStart(2, '0');
            }
        });
    </script>
</body>
</html>
