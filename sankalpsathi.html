<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>sankalp shiksha AI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary-color: #1a5f7a;
            --secondary-color: #0d8b6f;
            --text-color: #333;
            --bg-color: #f9f9f9;
            --card-bg: white;
            --input-bg: white;
            --border-color: #ddd;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --header-bg: rgba(255, 255, 255, 0.95);
            --message-user-bg: #1a5f7a;
            --message-bot-bg: #e8f4f6;
            --message-user-text: white;
            --message-bot-text: #333;
            --header-height: 49px;
        }

        body.dark-mode {
            --text-color: #f0f0f0;
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --input-bg: #2d2d2d;
            --border-color: #444;
            --shadow-color: rgba(0, 0, 0, 0.3);
            --header-bg: rgba(30, 30, 30, 0.95);
            --message-user-bg: #1a5f7a;
            --message-bot-bg: #2d3b41;
            --message-user-text: white;
            --message-bot-text: #f0f0f0;
        }

        body {
            height: 100vh;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: var(--text-color);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: background 0.3s, color 0.3s;
        }

        /* Header styling */
        .main-header {
            background: var(--header-bg);
            padding: 8px 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px var(--shadow-color);
            transition: background 0.3s, box-shadow 0.3s;
            height: var(--header-height);
            min-height: var(--header-height);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo-text {
            font-weight: bold;
            font-size: 1.5rem;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0px 2px 3px var(--shadow-color);
        }

        .sankalp-part {
            color: var(--primary-color);
            font-weight: 800;
        }

        .shiksha-part {
            color: var(--secondary-color);
            font-weight: 800;
        }

        .header-controls {
            display: flex;
            gap: 8px;
        }

        .header-controls button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: background 0.3s;
            font-size: 0.85rem;
        }

        .header-controls button:hover {
            background: #124b61;
        }

        /* Chat area styling */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            margin: 15px;
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 8px 20px var(--shadow-color);
            overflow: hidden;
            transition: background 0.3s, box-shadow 0.3s;
            max-width: 1200px;
            width: 95%;
            align-self: center;
        }

        .chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
            background: var(--bg-color);
            transition: background 0.3s;
        }

        .message {
            max-width: 80%;
            padding: 10px 14px;
            border-radius: 18px;
            line-height: 1.4;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .bot-message {
            align-self: flex-start;
            background: var(--message-bot-bg);
            border-bottom-left-radius: 5px;
            color: var(--message-bot-text);
            transition: background 0.3s, color 0.3s;
        }

        .user-message {
            align-self: flex-end;
            background: var(--message-user-bg);
            color: var(--message-user-text);
            border-bottom-right-radius: 5px;
        }

        .message-content {
            margin-bottom: 5px;
        }

        .timestamp {
            font-size: 0.7rem;
            text-align: right;
            margin-top: 5px;
            opacity: 0.7;
        }

        .chat-input-container {
            display: flex;
            flex-direction: column;
            padding: 12px;
            background: var(--card-bg);
            border-top: 1px solid var(--border-color);
            gap: 10px;
            transition: background 0.3s, border-color 0.3s;
        }

        .input-row {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
        }

        .image-preview-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
        }

        .image-upload-container {
            display: flex;
            align-items: center;
            flex-shrink: 0;
        }

        .image-upload-label {
            background: rgba(26, 95, 122, 0.1);
            border: 1px dashed rgba(26, 95, 122, 0.5);
            border-radius: 8px;
            padding: 8px 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .image-upload-label:hover {
            background: rgba(26, 95, 122, 0.2);
        }

        #image-upload {
            display: none;
        }

        .image-preview {
            max-width: 100px;
            max-height: 100px;
            border-radius: 8px;
            object-fit: cover;
            display: none;
        }

        .remove-image {
            background: #ff4757;
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            display: none;
            justify-content: center;
            align-items: center;
            font-size: 0.8rem;
        }

        .chat-input {
            flex: 1;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .chat-input input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 24px;
            outline: none;
            font-size: 1rem;
            transition: border-color 0.3s;
            background: var(--input-bg);
            color: var(--text-color);
        }

        .chat-input input:focus {
            border-color: var(--primary-color);
        }

        .send-button {
            background: var(--primary-color);
            color: white;
            border: none;
            width: 46px;
            height: 46px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background 0.3s;
            flex-shrink: 0;
        }

        .send-button:hover {
            background: #124b61;
        }

        .send-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .typing-indicator {
            display: flex;
            padding: 10px;
            gap: 5px;
            align-self: flex-start;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--primary-color);
            border-radius: 50%;
            opacity: 0.6;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typingAnimation {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.6;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }

        /* Suggestion chips styling */
        .suggestion-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
            margin-bottom: 5px;
        }

        .suggestion-chip {
            background: rgba(26, 95, 122, 0.1);
            border: 1px solid rgba(26, 95, 122, 0.3);
            border-radius: 16px;
            padding: 8px 12px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--text-color);
        }

        .suggestion-chip:hover {
            background: rgba(26, 95, 122, 0.2);
            transform: translateY(-2px);
        }

        /* Program buttons styling */
        .program-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .program-button {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            border-radius: 20px;
            padding: 10px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: 500;
        }

        .program-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px var(--shadow-color);
        }

        /* Footer with usage tips */
        .chat-footer {
            padding: 10px;
            text-align: center;
            background: var(--bg-color);
            border-top: 1px solid var(--border-color);
            font-size: 0.8rem;
            color: #777;
            transition: background 0.3s, border-color 0.3s;
        }

        /* Modal for settings */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
            color: var(--text-color);
            transition: background 0.3s, color 0.3s;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-header h2 {
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #777;
        }

        .config-group {
            margin-bottom: 15px;
        }

        .config-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--text-color);
        }

        .config-group input, .config-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            background: var(--input-bg);
            color: var(--text-color);
        }

        .config-group input:focus, .config-group select:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .model-info {
            background: rgba(26, 95, 122, 0.1);
            padding: 10px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 0.9rem;
            color: var(--text-color);
        }

        .keyboard-hint {
            text-align: center;
            font-size: 0.8rem;
            color: #777;
            padding: 5px;
            background: var(--bg-color);
            border-radius: 4px;
            margin-top: 5px;
        }

        /* Dark mode toggle */
        .dark-mode-toggle {
            position: relative;
            width: 60px;
            height: 30px;
            background: #ccc;
            border-radius: 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            padding: 0 5px;
            transition: background 0.3s;
        }

        .dark-mode-toggle.active {
            background: var(--primary-color);
        }

        .dark-mode-toggle::before {
            content: '';
            position: absolute;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: white;
            transition: transform 0.3s;
        }

        .dark-mode-toggle.active::before {
            transform: translateX(30px);
        }

        .dark-mode-toggle i {
            font-size: 0.8rem;
            z-index: 1;
        }

        .dark-mode-toggle .fa-moon {
            color: white;
            margin-right: auto;
        }

        .dark-mode-toggle .fa-sun {
            color: #f39c12;
            margin-left: auto;
        }

        .info-badge {
            background: rgba(26, 95, 122, 0.1);
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 0.7rem;
            color: var(--primary-color);
            margin-top: 5px;
            display: inline-block;
        }
        
        .source-indicator {
            font-size: 0.7rem;
            color: #777;
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .message-image {
            max-width: 200px;
            border-radius: 8px;
            margin-top: 8px;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .main-header {
                padding: 6px 10px;
            }
            
            .logo-text {
                font-size: 1rem;
            }
            
            .header-controls button span {
                display: none;
            }
            
            .header-controls button {
                padding: 5px 8px;
            }
            
            .chat-container {
                margin: 10px;
                width: calc(100% - 20px);
            }
            
            .message {
                max-width: 90%;
            }
            
            .image-upload-label span {
                display: none;
            }
            
            .send-button {
                width: 42px;
                height: 42px;
            }
            
            .input-row {
                flex-wrap: wrap;
            }
            
            .chat-input {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .chat-messages {
                padding: 12px;
            }
            
            .message {
                padding: 8px 12px;
                font-size: 0.95rem;
            }
            
            .modal-content {
                padding: 20px;
            }
            
            .image-upload-label {
                padding: 8px;
            }
            
            .chat-input-container {
                padding: 10px;
            }
            
            .chat-input input {
                padding: 10px 14px;
            }
        }
    </style>
</head>
<body>
    <!-- Main header with logo and controls -->
    <div class="main-header">
        <div class="logo">
            <i class="fas fa-graduation-cap"></i>
            <h1 class="logo-text"><span class="sankalp-part">Sankalp</span> <span class="shiksha-part">Sathi</span></h1>
        </div>
        <div class="header-controls">
            <div class="dark-mode-toggle" id="dark-mode-toggle">
                <i class="fas fa-moon"></i>
                <i class="fas fa-sun"></i>
            </div>
            <button id="settings-btn">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </button>
            <button id="clear-chat-btn">
                <i class="fas fa-broom"></i>
                <span>Clear Chat</span>
            </button>
            <button id="info-btn" title="About">
                <i class="fas fa-info-circle"></i>
                <span>About</span>
            </button>
        </div>
    </div>

    <!-- Chat container -->
    <div class="chat-container">
        <div class="chat-messages" id="chat-messages">
            <div class="message bot-message">
                <div class="message-content">
                    <p>Hello! I'm the Sankalp Shiksha AI Assistant, here to help you learn about our organization and its initiatives. üòä</p>
                    <p>You can ask me about:</p>
                    <div class="suggestion-chips">
                        <div class="suggestion-chip" data-question="What is Sankalp Shiksha?">What is Sankalp Shiksha?</div>
                        <div class="suggestion-chip" data-question="Tell me about your programs">Our programs</div>
                        <div class="suggestion-chip" data-question="What is your mission?">Our mission</div>
                        <div class="suggestion-chip" data-question="How can I contact you?">Contact information</div>
                    </div>
                    <p style="margin-top: 10px;">You can also upload images and ask questions about them!</p>
                </div>
                <div class="timestamp">Just now</div>
            </div>
        </div>
        
        <div class="chat-input-container">
            <div class="image-preview-container">
                <img id="image-preview" class="image-preview">
                <button class="remove-image" id="remove-image-btn">&times;</button>
            </div>
            
            <div class="input-row">
                <div class="image-upload-container">
                    <label for="image-upload" class="image-upload-label">
                        <i class="fas fa-image"></i>
                        <span>Upload</span>
                    </label>
                    <input type="file" id="image-upload" accept="image/*">
                </div>
                
                <div class="chat-input">
                    <input type="text" id="user-input" placeholder="Type your message here...">
                    <button class="send-button" id="send-btn">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>

        <div class="chat-footer">
            <p>Tip: Try asking about our programs, impact, team, or upload an image and ask questions about it</p>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settings-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-cog"></i> API Configuration</h2>
                <button class="close-modal">&times;</button>
            </div>
            
            <div class="config-group">
                <label for="api-key">API Key</label>
                <input type="password" id="api-key" value="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">
            </div>
            
            <div class="config-group">
                <label for="model-select">Model</label>
                <select id="model-select">
                    <option value="NexGenAiTech-X" selected>NexGenAiTech X</option>
                    <option value="google/gemini-2.5-flash-image-preview:free">NexGenAiTech Y (Image)</option>
                </select>
            </div>
            
            <div class="config-group">
                <label for="temperature">Temperature: <span id="temp-value">0.7</span></label>
                <input type="range" id="temperature" min="0" max="1" step="0.1" value="0.7">
            </div>
            
            <div class="config-group">
                <label for="max-tokens">Max Tokens</label>
                <input type="number" id="max-tokens" value="500">
            </div>
            
            <div class="keyboard-hint">
                <i class="fas fa-keyboard"></i> Press Enter to send, Shift+Enter for new line
            </div>
            
            <div class="model-info">
                <p><strong>Note:</strong> Sankalp Shiksha AI is an innovative digital learning initiative specially designed for rural and semi-urban students. Its mission is to make education simple, accessible, and personalized.</p>
                <p> Powered by Artificial Intelligence, this system helps students solve their doubts, provides subject-wise guidance, and even supports career counseling.</p>
            </div>
        </div>
    </div>

    <!-- Info Modal -->
    <div class="modal" id="info-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-info-circle"></i> About Sankalp Shiksha</h2>
                <button class="close-modal">&times;</button>
            </div>
            
            <div class="config-group">
                <p>Sankalp Shiksha Foundation is a non-profit organization based in Salemgarh Kushinagar, Uttar Pradesh, focused on rural education, digital literacy, and skill development.</p>
                
                <div class="model-info">
                    <p><strong>Key Initiatives:</strong></p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>Sankalp Digital Pathshala</li>
                        <li>Sankalp NextGen Lab</li>
                        <li>Rojgaar Buddy Skill Development</li>
                        <li>Community Development Programs</li>
                    </ul>
                </div>
                
                <p style="margin-top: 15px;">Founded during the COVID-19 pandemic, we've impacted over 2,310 students and 1,665 families across 60+ villages.</p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const chatMessages = document.getElementById('chat-messages');
            const userInput = document.getElementById('user-input');
            const sendButton = document.getElementById('send-btn');
            const clearChatBtn = document.getElementById('clear-chat-btn');
            const settingsBtn = document.getElementById('settings-btn');
            const infoBtn = document.getElementById('info-btn');
            const settingsModal = document.getElementById('settings-modal');
            const infoModal = document.getElementById('info-modal');
            const closeModalButtons = document.querySelectorAll('.close-modal');
            const apiKeyInput = document.getElementById('api-key');
            const modelSelect = document.getElementById('model-select');
            const temperatureInput = document.getElementById('temperature');
            const tempValue = document.getElementById('temp-value');
            const maxTokensInput = document.getElementById('max-tokens');
            const darkModeToggle = document.getElementById('dark-mode-toggle');
            const imageUpload = document.getElementById('image-upload');
            const imagePreview = document.getElementById('image-preview');
            const removeImageBtn = document.getElementById('remove-image-btn');
            
            let currentImageData = null;
            let currentModel = 'NexGenAiTech-X'; // Track current model
            
            // Check for saved dark mode preference
            if (localStorage.getItem('darkMode') === 'enabled') {
                document.body.classList.add('dark-mode');
                darkModeToggle.classList.add('active');
            }
            
            // Dark mode toggle functionality
            darkModeToggle.addEventListener('click', function() {
                document.body.classList.toggle('dark-mode');
                darkModeToggle.classList.toggle('active');
                
                // Save preference
                if (document.body.classList.contains('dark-mode')) {
                    localStorage.setItem('darkMode', 'enabled');
                } else {
                    localStorage.setItem('darkMode', 'disabled');
                }
            });
            
            // Update temperature value display
            temperatureInput.addEventListener('input', function() {
                tempValue.textContent = temperatureInput.value;
            });
            
            // Focus input on load (only once)
            userInput.focus();
            
            // Manual focus when user clicks on input
            userInput.addEventListener('click', function() {
                userInput.focus();
            });
            
            // Image upload functionality
            imageUpload.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        imagePreview.src = event.target.result;
                        imagePreview.style.display = 'block';
                        removeImageBtn.style.display = 'flex';
                        currentImageData = event.target.result;
                        // Automatically select Gemini when image is uploaded
                        modelSelect.value = 'google/gemini-2.5-flash-image-preview:free';
                        currentModel = 'google/gemini-2.5-flash-image-preview:free';
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // Remove image functionality
            removeImageBtn.addEventListener('click', function() {
                imagePreview.style.display = 'none';
                removeImageBtn.style.display = 'none';
                imageUpload.value = '';
                currentImageData = null;
                // Switch back to default model when image is removed
                modelSelect.value = 'NexGenAiTech-X';
                currentModel = 'NexGenAiTech-X';
            });
            
            // Modal functionality
            settingsBtn.addEventListener('click', function() {
                settingsModal.style.display = 'flex';
            });
            
            infoBtn.addEventListener('click', function() {
                infoModal.style.display = 'flex';
            });
            
            closeModalButtons.forEach(button => {
                button.addEventListener('click', function() {
                    settingsModal.style.display = 'none';
                    infoModal.style.display = 'none';
                });
            });
            
            // Close modal when clicking outside
            window.addEventListener('click', function(event) {
                if (event.target === settingsModal) {
                    settingsModal.style.display = 'none';
                }
                if (event.target === infoModal) {
                    infoModal.style.display = 'none';
                }
            });
            
            // Add event listeners
            sendButton.addEventListener('click', function() {
                userInput.focus(); // Focus when send button is clicked
                sendMessage();
            });
            
            // Send message on Enter key (but allow Shift+Enter for new line)
            userInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            // Clear chat button
            clearChatBtn.addEventListener('click', function() {
                if (confirm('Are you sure you want to clear the conversation?')) {
                    chatMessages.innerHTML = '';
                    addMessage('Conversation cleared. How can I help you learn about Sankalp Shiksha today?', 'bot');
                    // Add suggestion chips again after clearing
                    setTimeout(addSuggestionChips, 100);
                }
            });
            
            // Suggestion chip functionality
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('suggestion-chip')) {
                    const question = e.target.getAttribute('data-question');
                    userInput.value = question;
                    userInput.focus(); // Focus when suggestion is clicked
                    sendMessage();
                }
            });
            
            // Function to add suggestion chips
            function addSuggestionChips() {
                const suggestionChips = document.createElement('div');
                suggestionChips.classList.add('suggestion-chips');
                
                const questions = [
                    "What is Sankalp Shiksha?",
                    "Tell me about your programs",
                    "What is your mission?",
                    "How can I contact you?"
                ];
                
                questions.forEach(question => {
                    const chip = document.createElement('div');
                    chip.classList.add('suggestion-chip');
                    chip.setAttribute('data-question', question);
                    chip.textContent = question;
                    suggestionChips.appendChild(chip);
                });
                
                // Add to the last bot message
                const lastMessage = chatMessages.lastElementChild;
                if (lastMessage && lastMessage.classList.contains('bot-message')) {
                    lastMessage.querySelector('.message-content').appendChild(suggestionChips);
                }
            }
            
            // Function to add program buttons
            function addProgramButtons() {
                const programButtons = document.createElement('div');
                programButtons.classList.add('program-buttons');
                
                const programs = [
                    { text: "Digital Pathshala", question: "Tell me about Digital Pathshala" },
                    { text: "NextGen Lab", question: "What is NextGen Lab?" },
                    { text: "Rojgaar Buddy", question: "Explain Rojgaar Buddy program" },
                    { text: "Community Programs", question: "What community programs do you offer?" }
                ];
                
                programs.forEach(program => {
                    const button = document.createElement('button');
                    button.classList.add('program-button');
                    button.setAttribute('data-question', program.question);
                    button.innerHTML = `<i class="fas fa-arrow-right"></i> ${program.text}`;
                    programButtons.appendChild(button);
                    
                    // Add click event
                    button.addEventListener('click', function() {
                        userInput.value = program.question;
                        userInput.focus(); // Focus when program button is clicked
                        sendMessage();
                    });
                });
                
                // Add to the last bot message
                const lastMessage = chatMessages.lastElementChild;
                if (lastMessage && lastMessage.classList.contains('bot-message')) {
                    lastMessage.querySelector('.message-content').appendChild(programButtons);
                }
            }
            
            // Enhanced algorithm for question processing
            async function processQuestion(message, imageData) {
                // If there's an image, use the image processing API
                if (imageData) {
                    try {
                        const apiResponse = await getImageAIResponse(message, imageData);
                        return { finalResponse: apiResponse, source: "api" };
                    } catch (error) {
                        console.error('API Error:', error);
                        return { finalResponse: "Sorry, I couldn't process the image. Please try again.", source: "error" };
                    }
                }
                
                // Step 1: Analyze the question
                const questionAnalysis = analyzeQuestion(message);
                
                // Step 2: Try to get response from Sankalp knowledge base first
                let response = getEnhancedSankalpResponse(message);
                
                // Step 3: If we need additional information, use the API directly
                if (response.needAPI) {
                    try {
                        const apiResponse = await getContextualAIResponse(message, response.sankalpData);
                        response = { finalResponse: apiResponse, source: "api" };
                    } catch (error) {
                        console.error('API Error:', error);
                        // Fallback to Sankalp-only response
                        response = { finalResponse: response.sankalpData, source: "sankalp" };
                    }
                } else {
                    response = { finalResponse: response.sankalpData, source: "sankalp" };
                }
                
                return response;
            }
            
            // Enhanced question analysis
            function analyzeQuestion(message) {
                const lowerMessage = message.toLowerCase();
                const keywords = {
                    about: ['what is', 'who is', 'tell me about', 'explain'],
                    programs: ['program', 'course', 'initiative', 'digital pathshala', 'nextgen', 'rojgaar'],
                    impact: ['impact', 'result', 'achievement', 'student', 'family'],
                    team: ['team', 'founder', 'vikas', 'saurabh', 'abhishek'],
                    contact: ['contact', 'join', 'enroll', 'phone', 'email', 'address'],
                    policy: ['policy', 'refund', 'privacy', 'terms']
                };
                
                let category = 'general';
                let urgency = 'normal';
                
                // Determine category
                for (const [key, terms] of Object.entries(keywords)) {
                    if (terms.some(term => lowerMessage.includes(term))) {
                        category = key;
                        break;
                    }
                }
                
                // Determine urgency
                if (lowerMessage.includes('urgent') || lowerMessage.includes('emergency') || 
                    lowerMessage.includes('asap') || lowerMessage.includes('important')) {
                    urgency = 'high';
                }
                
                return { category, urgency, originalQuestion: message };
            }
            
            // Enhanced Sankalp response with comprehensive knowledge
            function getEnhancedSankalpResponse(message) {
                const lowerMessage = message.toLowerCase();
                let response = "";
                let needAPI = false;
                
                // Comprehensive response logic based on content
                if (lowerMessage.includes('what is') && lowerMessage.includes('sankalp')) {
                    response = `Sankalp Shiksha Foundation is a registered non-profit organization (CIN: U85300UP2020NPL138120) based in Salemgarh Kushinagar, Uttar Pradesh, focused on revolutionizing rural education through digital literacy and skill development. 

Our journey began during the COVID-19 lockdown when our founder Vikas Kumar started helping migrant workers in his village, which evolved into a permanent movement for rural education.

üìã <strong>Organization Details:</strong>
- <strong>Founded:</strong> November 18, 2020
- <strong>Registration:</strong> Unlisted private company
- <strong>Directors:</strong> Saurabh Kumar Sharma, Vikas Kumar, and Abhishek Kumar
- <strong>Legal Status:</strong> Not-for-profit organization

üéØ <strong>Our Mission:</strong> "To create a future where no rural child is left behind due to a lack of education."

üëÅÔ∏è <strong>Our Vision:</strong> "A rural India where every child has access to learning, digital literacy, and the chance to lead a dignified, empowered life through education."

We're different from other organizations with similar names as we're specifically focused on rural education in Uttar Pradesh. Our computer courses are transforming lives in rural communities!`;
                } 
                else if (lowerMessage.includes('program') || lowerMessage.includes('course') || lowerMessage.includes('initiative')) {
                    response = `Sankalp Shiksha runs several transformative programs:

1. <strong>Sankalp Digital Pathshala:</strong> Focuses on connecting rural students to digital education, bridging the rural-urban education gap, and promoting digital literacy and STEM education. We have a functional school in Kushinagar.

2. <strong>Sankalp NextGen Lab:</strong> Empowers rural youth with practical learning in STEM, robotics, and AI to diminish the urban-rural education gap.

3. <strong>Rojgaar Buddy:</strong> Our flagship skill-building initiative designed to provide rural youth aged 18-25 with essential digital and professional skills to become self-reliant.

4. <strong>Community Development Programs:</strong> Including disaster relief during COVID-19 and floods, cleanliness campaigns, festival celebrations with underprivileged children, and sports competitions.

Our computer courses are particularly popular and include:
- DCA (Diploma in Computer Applications)
- ADCA (Advanced Diploma in Computer Applications) 
- Digital Marketing with WordPress, SEO, and analytics

Which program would you like to know more about?`;
                }
                else if (lowerMessage.includes('impact') || lowerMessage.includes('achiev') || lowerMessage.includes('result')) {
                    response = `Sankalp Shiksha has made significant impact in rural communities:

üìä <strong>Quantitative Impact:</strong>
- Students: 2,310+ students reached
- Families: 1,665+ families impacted  
- Digital Classrooms: 10+ digital classrooms established
- Villages: 60+ villages covered

‚≠ê <strong>Qualitative Impact:</strong>
- Received positive testimonials from students like Aman Patel, Kamini Jaiswal, Twinkle, and Sibbu Kushwaha
- Praised by Vikas Chandra (S.D.M., Kushinagar) for our hard work
- Commended by Himanshu Kumar Barnawal (CEO, ADS BEE PVT. LTD.) for our holistic approach
- Endorsed by Dr. Nitin Gupta (Assistant Professor, NIT Hamirpur)

Our computer courses have been particularly effective in creating employment opportunities for rural youth!`;
                }
                else if (lowerMessage.includes('team') || lowerMessage.includes('founder') || lowerMessage.includes('vikas')) {
                    response = `Sankalp Shiksha was founded by Vikas Kumar, Saurabh Kumar Sharma, and Abhishek Kumar. 

<strong>Vikas Kumar</strong> is our driving force - an Analyst at Tredence Inc. with a B.Tech from NIT Hamirpur. He grew up in a village where education was difficult to attain and believes in giving back to society what he has received through education.

<strong>Our dedicated team includes:</strong>
- Paarvi: Marketing Strategies, PGP student at ISB with 4 years of experience in Supply Chain & Operations
- Vinumer Banyai: Team Member, pursuing MBA from IIM Trichy
- Ritesh Jaiswal: Team Member, IAS aspirant focused on girl-child education

<strong>Key Advisors:</strong>
- Dr. Kuldeep Sharma: Associate Professor at NIT-H
- Nitin Gupta: Assistant Professor at NIT-H  
- Shashi Bhusan: Ph.D. from IIT-Madras

Together, we're making computer education accessible to rural youth!`;
                }
                else if (lowerMessage.includes('contact') || lowerMessage.includes('join') || lowerMessage.includes('enroll')) {
                    response = `We'd love to have you involved with Sankalp Shiksha! 

üìû Phone: (+91) 9554 991 042
üìß Email: contact@sankalpshiksha.com

For our computer courses, we recommend calling us directly to learn about the next batch. Our team will guide you through enrollment, course fees, duration, and placement opportunities!

We're based in Salemgarh Kushinagar, Uttar Pradesh, and serve rural communities across the state.`;
                }
                else if (lowerMessage.includes('policy') || lowerMessage.includes('refund') || lowerMessage.includes('privacy')) {
                    response = `We maintain transparent policies to build trust with our community:

<strong>Refund Policy:</strong>
- Eligibility: Only for double/extra payments due to technical errors
- Procedure: Inform us via email, letter, or call within 15 days of donation
- Timeline: Refund processed within 30 days of request
- Fees: 2.5% deduction for online transactions, INR 300 for other methods

<strong>Privacy Policy:</strong>
- We don't collect personal information from casual website visitors
- For donations/sponsorships, we collect necessary details
- We use cookies to improve website experience
- Personal data is never sold or rented to third parties

<strong>Terms & Conditions:</strong>
- Prohibit security violations, illegal material distribution, and intellectual property infringement
- Users agree to hold us harmless from claims arising from website use
- All logos and brands are our property and require written permission for use`;
                }
                else {
                    // For questions not in our knowledge base, we'll need additional resources
                    needAPI = true;
                    response = "I need to consult additional resources to answer this question accurately.";
                }
                
                return { sankalpData: response, needAPI };
            }
            
            // Contextual API call with Sankalp-focused system message
            async function getContextualAIResponse(message, sankalpContext) {
                const apiKey = apiKeyInput.value;
                const model = currentModel; // Use the current model
                const temperature = parseFloat(temperatureInput.value);
                const maxTokens = parseInt(maxTokensInput.value);
                
                const modelMapping = {
                    "NexGenAiTech-X": "gpt-3.5-turbo",
                    "google/gemini-2.5-flash-image-preview:free": "gemini-pro"
                };
                
                const actualModel = modelMapping[model] || "gpt-3.5-turbo";
                
                // Enhanced system message to focus only on Sankalp Shiksha
                const systemMessage = `You are a helpful AI assistant exclusively for Sankalp Shiksha Foundation, a non-profit organization focused on rural education, digital literacy, and skill development in Salemgarh Kushinagar, Uttar Pradesh. 

Important guidelines:
1. Only provide information about Sankalp Shiksha Foundation, not any other organizations with similar names.
2. Always promote their computer courses (Rojgaar Buddy program) when relevant.
3. If asked about other "Sankalp" organizations, clarify that you only have information about Sankalp Shiksha Foundation.
4. Base your responses on the following context about Sankalp Shiksha:
${sankalpContext}

5. Be engaging, friendly, and provide detailed responses when appropriate.
6. Highlight how their initiatives are transforming rural education.`;

                const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: actualModel,
                        messages: [
                            { role: 'system', content: systemMessage },
                            { role: 'user', content: message }
                        ],
                        temperature: temperature,
                        max_tokens: maxTokens
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }
                
                const data = await response.json();
                return data.choices[0].message.content;
            }
            
            // Image processing API call
            async function getImageAIResponse(message, imageData) {
                const apiKey = apiKeyInput.value;
                
                const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${apiKey}`,
                        "HTTP-Referer": "https://sankalpshiksha.com", 
                        "X-Title": "Sankalp Shiksha AI Assistant",
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        "model": "google/gemini-2.5-flash-image-preview:free",
                        "messages": [
                            {
                                "role": "user",
                                "content": [
                                    {
                                        "type": "text",
                                        "text": message || "What is in this image?"
                                    },
                                    {
                                        "type": "image_url",
                                        "image_url": {
                                            "url": imageData
                                        }
                                    }
                                ]
                            }
                        ]
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }
                
                const data = await response.json();
                return data.choices[0].message.content;
            }
            
            // Function to send a message
            async function sendMessage() {
                const message = userInput.value.trim();
                const imageData = currentImageData;
                
                if (message === '' && !imageData) return;
                
                // Add user message to chat
                addMessage(message, 'user', imageData);
                
                // Clear input and disable send button
                userInput.value = '';
                sendButton.disabled = true;
                
                // Clear image
                if (imageData) {
                    imagePreview.style.display = 'none';
                    removeImageBtn.style.display = 'none';
                    imageUpload.value = '';
                    currentImageData = null;
                    // Reset model after sending image
                    modelSelect.value = 'NexGenAiTech-X';
                    currentModel = 'NexGenAiTech-X';
                }
                
                // Show typing indicator
                showTypingIndicator();
                
                try {
                    // Use the enhanced processing algorithm
                    const response = await processQuestion(message, imageData);
                    removeTypingIndicator();
                    addMessage(response.finalResponse, 'bot');
                    
                    // Add appropriate badge based on source
                    if (response.source === "sankalp") {
                        addInfoBadge("From Sankalp Shiksha Knowledge Base");
                    } else if (response.source === "api") {
                        addInfoBadge("With information from NexGenAiTech"); // Changed text here
                    }
                    
                    // If the message is about what Sankalp Shiksha is, add program buttons
                    if (message.toLowerCase().includes('what is sankalp') || 
                        message.toLowerCase().includes('about sankalp')) {
                        setTimeout(addProgramButtons, 100);
                    }
                } catch (error) {
                    console.error('Error:', error);
                    removeTypingIndicator();
                    addMessage('Sorry, I encountered an error processing your request. Please try again.', 'bot');
                } finally {
                    sendButton.disabled = false;
                }
            }
            
            // Function to add info badge
            function addInfoBadge(text) {
                const badge = document.createElement('div');
                badge.classList.add('info-badge');
                badge.textContent = text;
                
                const lastMessage = chatMessages.lastElementChild;
                if (lastMessage && lastMessage.classList.contains('bot-message')) {
                    lastMessage.appendChild(badge);
                }
            }
            
            // Function to add a message to the chat
            function addMessage(text, sender, imageData = null) {
                const messageElement = document.createElement('div');
                messageElement.classList.add('message');
                messageElement.classList.add(sender + '-message');
                
                const messageContent = document.createElement('div');
                messageContent.classList.add('message-content');
                
                // Handle image if present
                if (imageData && sender === 'user') {
                    const imageElement = document.createElement('img');
                    imageElement.src = imageData;
                    imageElement.classList.add('message-image');
                    messageContent.appendChild(imageElement);
                }
                
                // Handle text if present
                if (text && text.trim() !== '') {
                    // Handle line breaks and basic formatting in the text
                    const lines = text.split('\n');
                    lines.forEach((line, index) => {
                        if (line.trim() !== '') {
                            // Check if line contains HTML tags (like <strong>)
                            if (/<[a-z][\s\S]*>/i.test(line)) {
                                messageContent.innerHTML += line + '<br>';
                            } else {
                                const messageText = document.createElement('p');
                                messageText.innerHTML = line;
                                messageContent.appendChild(messageText);
                            }
                        }
                    });
                }
                
                const timestamp = document.createElement('div');
                timestamp.classList.add('timestamp');
                timestamp.textContent = getCurrentTime();
                
                messageElement.appendChild(messageContent);
                messageElement.appendChild(timestamp);
                
                chatMessages.appendChild(messageElement);
                
                // Scroll to bottom
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            // Function to show typing indicator
            function showTypingIndicator() {
                const typingElement = document.createElement('div');
                typingElement.classList.add('typing-indicator');
                typingElement.id = 'typing-indicator';
                
                for (let i = 0; i < 3; i++) {
                    const dot = document.createElement('div');
                    dot.classList.add('typing-dot');
                    typingElement.appendChild(dot);
                }
                
                chatMessages.appendChild(typingElement);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            // Function to remove typing indicator
            function removeTypingIndicator() {
                const typingElement = document.getElementById('typing-indicator');
                if (typingElement) {
                    typingElement.remove();
                }
            }
            
            // Function to get current time in HH:MM format
            function getCurrentTime() {
                const now = new Date();
                return now.getHours().toString().padStart(2, '0') + ':' + 
                       now.getMinutes().toString().padStart(2, '0');
            }
        });
    </script>
</body>
</html>