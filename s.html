<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sankalp Shiksha - Class 9 English Grammar Quiz</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Poppins', 'Segoe UI', sans-serif;
            transition: all 0.3s ease;
        }
        
        body {
            background: linear-gradient(135deg, #87CEEB 0%, #B0E2FF 50%, #87CEEB 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow-x: hidden;
        }
        
        body.dark-mode {
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
            color: #f0f0f0;
        }
        
        .container {
            width: 95%;
            max-width: 1000px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
            padding: 30px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
            animation: fadeInUp 0.8s ease;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        
        .dark-mode .container {
            background: rgba(30, 30, 46, 0.95);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        header {
            text-align: center;
            margin-bottom: 25px;
            position: relative;
            padding: 10px 0;
        }
        
        h1 {
            color: #1a3c6e;
            margin-bottom: 8px;
            font-size: 2.2rem;
            font-weight: 700;
        }
        
        .dark-mode h1 {
            color: #f0f0f0;
        }
        
        .description {
            color: #4a6fa5;
            font-size: 1rem;
            max-width: 700px;
            margin: 0 auto;
            line-height: 1.5;
        }
        
        .dark-mode .description {
            color: #bdc3c7;
        }
        
        .header {
            background: linear-gradient(135deg, #1a6fc4 0%, #2a8bf2 100%);
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
            border-radius: 15px 15px 0 0;
            margin: -30px -30px 25px -30px;
            box-shadow: 0 8px 25px rgba(42, 139, 242, 0.3);
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><path d="M0,0 L100,0 L100,100 Z" fill="rgba(255,255,255,0.1)"/></svg>');
            background-size: cover;
        }
        
        .header h1 {
            font-size: 32px;
            margin-bottom: 8px;
            font-weight: 800;
            color: white;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            position: relative;
            z-index: 1;
        }
        
        .header p {
            font-size: 16px;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }
        
        .login-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .login-form {
            width: 100%;
            max-width: 500px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 35px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.5);
            position: relative;
            overflow: hidden;
        }
        
        .login-form::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(135deg, #1a6fc4 0%, #2a8bf2 100%);
        }
        
        .dark-mode .login-form {
            background: linear-gradient(135deg, #1e1e2e 0%, #2d2d44 100%);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        
        .login-form h2 {
            text-align: center;
            margin-bottom: 25px;
            color: #1a3c6e;
            font-weight: 700;
            position: relative;
        }
        
        .dark-mode .login-form h2 {
            color: #f0f0f0;
        }
        
        .form-group {
            margin-bottom: 22px;
            position: relative;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #1a3c6e;
            font-weight: 600;
            font-size: 14px;
            display: flex;
            align-items: center;
        }
        
        .form-group label i {
            margin-right: 8px;
            color: #2a8bf2;
        }
        
        .dark-mode .form-group label {
            color: #f0f0f0;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #c5d9f1;
            border-radius: 10px;
            font-size: 15px;
            transition: all 0.3s;
            background: #f8fafc;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .dark-mode .form-group input, .dark-mode .form-group select, .dark-mode .form-group textarea {
            background: #2d2d44;
            border-color: #1e1e2e;
            color: #f0f0f0;
        }
        
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            border-color: #2a8bf2;
            outline: none;
            box-shadow: 0 0 0 3px rgba(42, 139, 242, 0.2);
            background: white;
            transform: translateY(-2px);
        }
        
        .dark-mode .form-group input:focus, .dark-mode .form-group select:focus, .dark-mode .form-group textarea:focus {
            background: #1e1e2e;
        }
        
        button {
            background: linear-gradient(135deg, #1a6fc4 0%, #2a8bf2 100%);
            color: white;
            border: none;
            padding: 14px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 6px 15px rgba(42, 139, 242, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
        }
        
        button:hover::before {
            left: 100%;
        }
        
        button:hover {
            background: linear-gradient(135deg, #2a8bf2 0%, #1a6fc4 100%);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(42, 139, 242, 0.4);
        }
        
        .login-btn {
            width: 100%;
            padding: 15px;
            font-size: 1.1rem;
            margin-top: 10px;
        }
        
        .toggle-form {
            display: none;
        }
        
        .user-info-panel {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 18px;
            border-radius: 12px;
            margin-bottom: 25px;
            font-size: 15px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
            border-left: 5px solid #2a8bf2;
            animation: slideIn 0.5s ease;
        }
        
        .dark-mode .user-info-panel {
            background: linear-gradient(135deg, #1e1e2e 0%, #2d2d44 100%);
        }
        
        .user-details {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .user-name {
            font-weight: 700;
            color: #1a3c6e;
            font-size: 18px;
        }
        
        .dark-mode .user-name {
            color: #f0f0f0;
        }
        
        .user-reg {
            color: #4a6fa5;
        }
        
        .dark-mode .user-reg {
            color: #bdc3c7;
        }
        
        .logout-btn {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            padding: 10px 18px;
            font-size: 15px;
            width: auto;
            box-shadow: 0 6px 15px rgba(231, 76, 60, 0.3);
        }
        
        .logout-btn:hover {
            background: linear-gradient(135deg, #c0392b 0%, #e74c3c 100%);
            box-shadow: 0 8px 20px rgba(231, 76, 60, 0.4);
        }
        
        .quiz-container, .results-container {
            display: none;
        }
        
        .question {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
            border-left: 5px solid #2a8bf2;
            animation: fadeIn 0.5s ease;
        }
        
        .dark-mode .question {
            background: #2d2d44;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }
        
        .question h3 {
            margin-bottom: 15px;
            color: #1a3c6e;
            font-size: 1.3rem;
        }
        
        .dark-mode .question h3 {
            color: #f0f0f0;
        }
        
        .question p {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 18px;
            margin-top: 20px;
        }
        
        .option {
            padding: 18px;
            background: #e8f4fc;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-weight: 500;
            font-size: 1.05rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }
        
        .dark-mode .option {
            background: #2d2d44;
        }
        
        .option:hover {
            background: #d1e9fa;
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
            border-color: #2a8bf2;
        }
        
        .dark-mode .option:hover {
            background: #1e1e2e;
        }
        
        .selected {
            background: #4CAF50 !important;
            color: white !important;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.4) !important;
            border-color: #2E7D32 !important;
        }
        
        .dark-mode .selected {
            background: #4CAF50 !important;
            color: white !important;
        }
        
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        .nav-btn {
            width: 48%;
            padding: 14px;
        }
        
        .nav-btn.secondary {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            box-shadow: 0 6px 15px rgba(149, 165, 166, 0.3);
        }
        
        .nav-btn.secondary:hover {
            background: linear-gradient(135deg, #7f8c8d 0%, #95a5a6 100%);
            box-shadow: 0 8px 20px rgba(149, 165, 166, 0.4);
        }
        
        .results-container {
            text-align: center;
        }
        
        .score {
            font-size: 3rem;
            font-weight: bold;
            background: linear-gradient(135deg, #1a6fc4 0%, #2a8bf2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 25px 0;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .dark-mode .score {
            background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .analysis {
            text-align: left;
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin-top: 25px;
            font-size: 1rem;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
        }
        
        .dark-mode .analysis {
            background: #2d2d44;
        }
        
        .correct {
            color: #27ae60;
            font-weight: bold;
        }
        
        .incorrect {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .progress {
            height: 12px;
            background: #ecf0f1;
            border-radius: 6px;
            margin-bottom: 25px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .dark-mode .progress {
            background: #2d2d44;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(135deg, #2a8bf2 0%, #1a6fc4 100%);
            border-radius: 6px;
            width: 0%;
            transition: width 0.5s;
            position: relative;
            overflow: hidden;
        }
        
        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .loading {
            text-align: center;
            padding: 30px;
            display: none;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #2a8bf2;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        .badge {
            display: inline-block;
            background: linear-gradient(135deg, #2a8bf2 0%, #1a6fc4 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
            margin-right: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .timer-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px 20px;
            background: #f8f9fa;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
            border-left: 5px solid #e74c3c;
        }
        
        .dark-mode .timer-container {
            background: #2d2d44;
        }
        
        .timer {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1a3c6e;
        }
        
        .dark-mode .timer {
            color: #f0f0f0;
        }
        
        .timer.warning {
            color: #e74c3c;
            animation: pulse 1s infinite;
        }
        
        .footer {
            margin-top: 35px;
            text-align: center;
            color: #4a6fa5;
            font-size: 0.9rem;
        }
        
        .dark-mode .footer {
            color: #bdc3c7;
        }
        
        .footer a {
            color: #2a8bf2;
            text-decoration: none;
        }
        
        .footer a:hover {
            text-decoration: underline;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            animation: modalAppear 0.3s ease;
        }
        
        @keyframes modalAppear {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .dark-mode .modal-content {
            background: #1e1e2e;
            color: #f0f0f0;
        }
        
        .close-modal {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 28px;
            cursor: pointer;
            color: #777;
            transition: color 0.3s;
        }
        
        .dark-mode .close-modal {
            color: #bdc3c7;
        }
        
        .close-modal:hover {
            color: #333;
        }
        
        .dark-mode .close-modal:hover {
            color: #f0f0f0;
        }
        
        .question-analysis {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .dark-mode .question-analysis {
            border-bottom: 1px solid #2d2d44;
        }
        
        .question-analysis:last-child {
            border-bottom: none;
        }
        
        .correct-answer {
            background: #d4edda;
            padding: 12px;
            border-radius: 6px;
            margin-top: 10px;
            font-size: 0.95rem;
            border-left: 4px solid #27ae60;
        }
        
        .dark-mode .correct-answer {
            background: #27ae60;
            color: white;
        }
        
        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .quiz-title {
            font-size: 1.7rem;
            color: #1a3c6e;
            font-weight: 700;
        }
        
        .dark-mode .quiz-title {
            color: #f0f0f0;
        }
        
        .centered-button-container {
            display: flex;
            justify-content: center;
            margin: 25px 0;
        }
        
        .centered-button {
            width: 100%;
            max-width: 300px;
        }
        
        .mode-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #1a3c6e;
            color: white;
            border: none;
            border-radius: 50%;
            width: 55px;
            height: 55px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
            z-index: 100;
            transition: all 0.3s;
        }
        
        .dark-mode .mode-toggle {
            background: #f0f0f0;
            color: #1a3c6e;
        }
        
        .mode-toggle:hover {
            transform: scale(1.1) rotate(15deg);
        }
        
        .instruction-toggle {
            position: fixed;
            top: 20px;
            right: 85px;
            background: #2a8bf2;
            color: white;
            border: none;
            border-radius: 50%;
            width: 55px;
            height: 55px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
            z-index: 100;
            transition: all 0.3s;
        }
        
        .dark-mode .instruction-toggle {
            background: #1a6fc4;
            color: #f0f0f0;
        }
        
        .instruction-toggle:hover {
            background: #1a6fc4;
            transform: scale(1.1);
        }
        
        .dark-mode .instruction-toggle:hover {
            background: #1560b3;
        }
        
        .review-panel {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
            border: 2px solid #2a8bf2;
        }
        
        .dark-mode .review-panel {
            background: #2d2d44;
        }
        
        .review-title {
            font-weight: 700;
            margin-bottom: 15px;
            color: #1a3c6e;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2rem;
        }
        
        .dark-mode .review-title {
            color: #f0f0f0;
        }
        
        .review-status {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 0.95rem;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-color {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            display: inline-block;
        }
        
        .status-answered {
            background-color: #27ae60;
        }
        
        .status-skipped {
            background-color: #f39c12;
        }
        
        .status-unanswered {
            background-color: #e74c3c;
        }
        
        .status-current {
            background-color: #2a8bf2;
        }
        
        .review-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        
        .review-btn {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            cursor: pointer;
            border: 2px solid #ddd;
            background: white;
            color: #333;
            transition: all 0.2s;
            font-size: 1rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .dark-mode .review-btn {
            background: #1e1e2e;
            color: #f0f0f0;
            border-color: #2d2d44;
        }
        
        .review-btn.answered {
            background: #27ae60;
            color: white;
            border-color: #27ae60;
        }
        
        .review-btn.skipped {
            background: #f39c12;
            color: white;
            border-color: #f39c12;
        }
        
        .review-btn.unanswered {
            background: #e74c3c;
            color: white;
            border-color: #e74c3c;
        }
        
        .review-btn.current {
            border: 3px solid #2a8bf2;
            box-shadow: 0 0 15px rgba(42, 139, 242, 0.7);
            transform: scale(1.1);
        }
        
        .info-text {
            font-size: 12px;
            color: #4a6fa5;
            margin-top: 4px;
            font-style: italic;
        }
        
        .welcome-animation {
            text-align: center;
            padding: 30px;
            margin-bottom: 25px;
            background: linear-gradient(135deg, #1a6fc4 0%, #2a8bf2 100%);
            border-radius: 15px;
            color: white;
            animation: fadeIn 1s ease-in-out;
            box-shadow: 0 10px 25px rgba(42, 139, 242, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .welcome-animation::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><path d="M0,0 L100,0 L100,100 Z" fill="rgba(255,255,255,0.1)"/></svg>');
            background-size: cover;
        }
        
        .welcome-animation h2 {
            margin-bottom: 10px;
            font-size: 2rem;
            position: relative;
            z-index: 1;
        }
        
        .welcome-animation p {
            font-size: 1.1rem;
            position: relative;
            z-index: 1;
        }
        
        .saving-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            display: none;
            backdrop-filter: blur(5px);
        }
        
        .saving-content {
            background: white;
            padding: 35px;
            border-radius: 15px;
            text-align: center;
            max-width: 450px;
            width: 90%;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            animation: modalAppear 0.3s ease;
        }
        
        .dark-mode .saving-content {
            background: #1e1e2e;
            color: #f0f0f0;
        }
        
        .saving-spinner {
            width: 60px;
            height: 60px;
            border: 6px solid #f3f3f3;
            border-top: 6px solid #2a8bf2;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 25px;
        }
        
        .dark-mode .saving-spinner {
            border: 6px solid #2d2d44;
            border-top: 6px solid #2a8bf2;
        }
        
        .feedback-saving {
            display: none;
            text-align: center;
            margin: 15px 0;
        }
        
        .feedback-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #2a8bf2;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 10px;
        }
        
        .confirmation-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }
        
        .confirmation-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            animation: modalAppear 0.3s ease;
        }
        
        .dark-mode .confirmation-content {
            background: #1e1e2e;
            color: #f0f0f0;
        }
        
        .confirmation-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 25px;
        }
        
        .confirm-btn {
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
        }
        
        .confirm-yes {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }
        
        .confirm-no {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            color: white;
        }
        
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }
        
        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            animation: float 15s infinite linear;
        }
        
        @keyframes float {
            0% { transform: translateY(0) translateX(0) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100vh) translateX(100px) rotate(360deg); opacity: 0; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .email-status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-weight: 600;
        }
        
        .email-success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }
        
        .email-error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }
        
        .email-info {
            background: #cce7ff;
            color: #004085;
            border-left: 4px solid #007bff;
        }
        
        @media (max-width: 900px) {
            .options {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .container {
                padding: 20px;
            }
            
            .review-buttons {
                gap: 8px;
            }
            
            .review-btn {
                width: 35px;
                height: 35px;
                font-size: 0.9rem;
            }
        }
        
        @media (max-width: 600px) {
            body {
                padding: 15px;
            }
            
            .container {
                width: 100%;
                padding: 15px;
            }
            
            h1 {
                font-size: 1.6rem;
            }
            
            .mode-toggle, .instruction-toggle {
                top: 10px;
                right: 10px;
                width: 45px;
                height: 45px;
                font-size: 1.1rem;
            }
            
            .instruction-toggle {
                right: 65px;
            }
            
            .review-status {
                flex-direction: column;
                gap: 8px;
            }
            
            .user-info-panel {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .review-buttons {
                gap: 6px;
            }
            
            .review-btn {
                width: 30px;
                height: 30px;
                font-size: 0.8rem;
            }
            
            .confirmation-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="particles" id="particles"></div>
    
    <div class="saving-overlay" id="savingOverlay">
        <div class="saving-content">
            <div class="saving-spinner"></div>
            <h3>Saving Results...</h3>
            <p>Please wait while we save your quiz results to Google Docs.</p>
            <p id="savingStatus">Connecting to server...</p>
        </div>
    </div>
    
    <div class="confirmation-modal" id="confirmationModal">
        <div class="confirmation-content">
            <h2><i class="fas fa-exclamation-triangle"></i> Confirm Logout</h2>
            <p>Are you sure you want to logout? Your progress will be lost.</p>
            <div class="confirmation-buttons">
                <button class="confirm-btn confirm-yes" id="confirmLogout">Yes, Logout</button>
                <button class="confirm-btn confirm-no" id="cancelLogout">Cancel</button>
            </div>
        </div>
    </div>
    
    <button class="instruction-toggle" id="instructionToggle">
        <i class="fas fa-info-circle"></i>
    </button>
    
    <button class="mode-toggle" id="modeToggle">
        <i class="fas fa-moon"></i>
    </button>
    
    <div class="container">
        <div class="header">
            <h1>Sankalp Shiksha - Class 9 English Grammar Quiz</h1>
            <p>Test Your Knowledge & Improve Your Skills</p>
        </div>
        
        <div class="welcome-animation" id="welcomeAnimation" style="display: none;">
            <h2>Welcome, <span id="welcomeName">Student</span>!</h2>
            <p>Good luck with your quiz. You have 60 minutes to complete 50 questions.</p>
        </div>
        
        <div class="login-section" id="loginSection">
            <div class="login-form">
                <h2><i class="fas fa-user-graduate"></i> Student Information</h2>
                <form id="login-form">
                    <div class="form-group">
                        <label for="login-name"><i class="fas fa-user"></i> Student Name</label>
                        <input type="text" id="login-name" required placeholder="Enter your full name">
                    </div>
                    
                    <div class="form-group">
                        <label for="login-mobile"><i class="fas fa-mobile-alt"></i> Mobile Number</label>
                        <input type="text" id="login-mobile" required placeholder="Enter your mobile number" maxlength="10">
                    </div>
                    
                    <div class="form-group">
                        <label for="login-father"><i class="fas fa-user-friends"></i> Father's Name</label>
                        <input type="text" id="login-father" required placeholder="Enter your father's name">
                    </div>
                    
                    <div class="form-group">
                        <label for="login-computer"><i class="fas fa-desktop"></i> Computer Number</label>
                        <input type="text" id="login-computer" required placeholder="Enter your computer number">
                    </div>
                    
                    <div class="form-group">
                        <label for="login-class"><i class="fas fa-graduation-cap"></i> Class</label>
                        <input type="text" id="login-class" value="Class 9" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="login-subject"><i class="fas fa-book"></i> Subject</label>
                        <input type="text" id="login-subject" value="English Grammar" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="login-testcode"><i class="fas fa-key"></i> Test Code</label>
                        <input type="text" id="login-testcode" required placeholder="Enter test code" maxlength="4">
                        <div class="info-text">Please ask your teacher for the test code</div>
                    </div>
                    
                    <button type="submit" class="login-btn"><i class="fas fa-play-circle"></i> Start Quiz</button>
                </form>
            </div>
        </div>
        
        <div class="user-info-panel" id="userInfoPanel" style="display: none;">
            <div class="user-details">
                <div class="user-name" id="display-student-name">Student Name</div>
                <div class="user-reg" id="display-mobile">Mobile Number</div>
                <div class="user-reg" id="display-class">Class & Subject</div>
                <div class="user-reg" id="display-computer">Computer Number</div>
            </div>
            <button class="logout-btn" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</button>
        </div>
        
        <div class="quiz-container" id="quizContainer">
            <div class="quiz-header">
                <h2 class="quiz-title" id="quizTitle">Class 9 English Grammar Quiz</h2>
            </div>
            
            <div class="timer-container">
                <div id="timeRemainingText">Time Remaining:</div>
                <div class="timer" id="timer">60:00</div>
            </div>
            
            <div class="review-panel" id="reviewPanel">
                <div class="review-title">
                    <i class="fas fa-list"></i> <span id="questionReviewText">Question Review</span>
                </div>
                <div class="review-status">
                    <div class="status-item">
                        <span class="status-color status-answered"></span>
                        <span id="answeredText">Answered</span>
                    </div>
                    <div class="status-item">
                        <span class="status-color status-skipped"></span>
                        <span id="skippedText">Skipped</span>
                    </div>
                    <div class="status-item">
                        <span class="status-color status-unanswered"></span>
                        <span id="unansweredText">Unanswered</span>
                    </div>
                    <div class="status-item">
                        <span class="status-color status-current"></span>
                        <span id="currentText">Current</span>
                    </div>
                </div>
                <div class="review-buttons" id="reviewButtons"></div>
            </div>
            
            <div class="progress">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <div id="questionContainer"></div>
            <div class="navigation">
                <button class="nav-btn secondary" id="prevBtn"><i class="fas fa-arrow-left"></i> <span id="prevText">Previous</span></button>
                <button class="nav-btn" id="nextBtn"><span id="nextText">Next</span> <i class="fas fa-arrow-right"></i></button>
            </div>
            <div class="centered-button-container">
                <button id="submitQuiz" class="centered-button" style="display: none;"><i class="fas fa-paper-plane"></i> <span id="submitText">Submit Quiz</span></button>
            </div>
        </div>
        
        <div class="results-container" id="resultsContainer">
            <h2><i class="fas fa-chart-line"></i> <span id="resultsText">Quiz Results</span></h2>
            <div class="score" id="score"></div>
            <div class="analysis" id="analysis"></div>
            
            <div id="emailStatus" class="email-status" style="display: none;"></div>
            
            <div class="centered-button-container">
                <button id="feedbackBtn" class="centered-button"><i class="fas fa-comment"></i> <span id="feedbackText">Feedback</span></button>
            </div>
        </div>
        
        <div class="footer">
            <p>Powered by NexGenAiTech</p>
        </div>
    </div>

    <div class="modal" id="instructionModal">
        <div class="modal-content">
            <span class="close-modal" id="closeInstructionModal">&times;</span>
            <h2><i class="fas fa-info-circle"></i> <span id="instructionTitle">Quiz Instructions</span></h2>
            
            <div style="margin-top: 20px;">
                <h3 style="color: #e74c3c; margin-bottom: 15px;">
                    <i class="fas fa-exclamation-triangle"></i> <span id="importantWarning">Important Warning:</span>
                </h3>
                <p style="background: #ffeaa7; padding: 10px; border-radius: 5px; margin-bottom: 20px;">
                    <strong id="warningText">Any kind of copying will result in disqualification of your test.</strong>
                </p>
                
                <h3 style="margin-bottom: 10px;" id="testInstructions">Test Instructions:</h3>
                <ul style="padding-left: 20px; margin-bottom: 20px;" id="instructionsList">
                    <li>This quiz has a total of 50 questions</li>
                    <li>You have 60 minutes to complete the test</li>
                    <li>Each question has four options, choose the correct answer</li>
                    <li>Navigate between questions using Previous and Next buttons</li>
                    <li>Go directly to any question using the Question Review panel</li>
                    <li>Once you select an answer, it will be automatically saved</li>
                    <li>You can change your answer at any time</li>
                    <li>Click the Submit Quiz button after completing the test</li>
                </ul>
                
                <p style="font-style: italic; color: #7f8c8d;" id="instructionNote">
                    Read all instructions carefully and take the test honestly.
                </p>
            </div>
        </div>
    </div>

    <div class="modal" id="feedbackModal">
        <div class="modal-content">
            <span class="close-modal" id="closeFeedbackModal">&times;</span>
            <h2><i class="fas fa-comment"></i> <span id="feedbackTitle">Feedback</span></h2>
            
            <form id="feedback-form">
                <div class="form-group">
                    <label for="feedback-name" id="feedbackNameLabel">Student Name</label>
                    <input type="text" id="feedback-name" readonly>
                </div>
                
                <div class="form-group">
                    <label for="feedback-mobile" id="feedbackMobileLabel">Mobile Number</label>
                    <input type="text" id="feedback-mobile" readonly>
                </div>
                
                <div class="form-group">
                    <label for="feedback-computer" id="feedbackComputerLabel">Computer Number</label>
                    <input type="text" id="feedback-computer" readonly>
                </div>
                
                <div class="form-group">
                    <label for="feedback-message" id="feedbackMessageLabel">Message for Updates</label>
                    <textarea id="feedback-message" rows="5" required placeholder="Your feedback or message for new updates"></textarea>
                </div>
                
                <div class="feedback-saving" id="feedbackSaving">
                    <div class="feedback-spinner"></div>
                    <span id="savingFeedbackText">Saving your feedback...</span>
                </div>
                
                <button type="submit" class="login-btn" id="feedbackSubmitBtn"><span id="submitFeedbackText">Submit Feedback</span></button>
            </form>
            
            <div class="result" id="feedback-result" style="display: none; margin-top: 15px; padding: 15px; background: #e8f4fc; border-radius: 6px; border-left: 4px solid #4361ee;">
                <h3><i class="fas fa-check-circle"></i> <span id="feedbackSuccessTitle">Feedback Submitted Successfully!</span></h3>
                <p id="feedbackSuccessText">Thank you for your valuable feedback.</p>
            </div>
        </div>
    </div>

    <script>
        // DOM elements
        const loginSection = document.getElementById('loginSection');
        const userInfoPanel = document.getElementById('userInfoPanel');
        const quizContainer = document.getElementById('quizContainer');
        const resultsContainer = document.getElementById('resultsContainer');
        const questionContainer = document.getElementById('questionContainer');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const submitQuiz = document.getElementById('submitQuiz');
        const progressBar = document.getElementById('progressBar');
        const scoreElement = document.getElementById('score');
        const analysisElement = document.getElementById('analysis');
        const feedbackBtn = document.getElementById('feedbackBtn');
        const timerElement = document.getElementById('timer');
        const reviewButtons = document.getElementById('reviewButtons');
        const modeToggle = document.getElementById('modeToggle');
        const instructionToggle = document.getElementById('instructionToggle');
        const modeIcon = modeToggle.querySelector('i');
        const loginForm = document.getElementById('login-form');
        const feedbackModal = document.getElementById('feedbackModal');
        const instructionModal = document.getElementById('instructionModal');
        const feedbackForm = document.getElementById('feedback-form');
        const closeFeedbackModal = document.getElementById('closeFeedbackModal');
        const closeInstructionModal = document.getElementById('closeInstructionModal');
        const feedbackResult = document.getElementById('feedback-result');
        const displayStudentName = document.getElementById('display-student-name');
        const displayMobile = document.getElementById('display-mobile');
        const displayClass = document.getElementById('display-class');
        const displayComputer = document.getElementById('display-computer');
        const feedbackName = document.getElementById('feedback-name');
        const feedbackMobile = document.getElementById('feedback-mobile');
        const feedbackComputer = document.getElementById('feedback-computer');
        const welcomeAnimation = document.getElementById('welcomeAnimation');
        const welcomeName = document.getElementById('welcomeName');
        const savingOverlay = document.getElementById('savingOverlay');
        const savingStatus = document.getElementById('savingStatus');
        const feedbackSaving = document.getElementById('feedbackSaving');
        const feedbackSubmitBtn = document.getElementById('feedbackSubmitBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const confirmationModal = document.getElementById('confirmationModal');
        const confirmLogout = document.getElementById('confirmLogout');
        const cancelLogout = document.getElementById('cancelLogout');
        const particlesContainer = document.getElementById('particles');
        const emailStatus = document.getElementById('emailStatus');
        
        // Google Apps Script URLs
        const DETAILED_RESULTS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyDQPaaj3mB0_Ctw6tqqxigo1y9_P9cQs16mAljqrR1QwsomHHq1ImuQ00OtDjhXd_L/exec';
        const SUMMARY_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyjuDlzBCp0D559rHAeOmCCpVk6aGHLlMYCdkfvRslI-GBAGgzDT2yWu11FMB4gMN-8/exec';
        const FEEDBACK_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxTjICjfahA7EL_bgpzshrYxwIXSOhGw3Qiq-TZOreIwr0unSYklfiiQzK_1hoah63P/exec';
        
        // Quiz state variables
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let quizData = [];
        let timerInterval = null;
        let timeLeft = 0;
        let visitedQuestions = [];
        let currentUser = null;
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Set up event listeners
            loginForm.addEventListener('submit', handleLogin);
            prevBtn.addEventListener('click', showPreviousQuestion);
            nextBtn.addEventListener('click', showNextQuestion);
            submitQuiz.addEventListener('click', showResults);
            feedbackBtn.addEventListener('click', showFeedbackModal);
            modeToggle.addEventListener('click', toggleDarkMode);
            instructionToggle.addEventListener('click', showInstructionModal);
            feedbackForm.addEventListener('submit', handleFeedback);
            closeFeedbackModal.addEventListener('click', closeFeedbackModalFunc);
            closeInstructionModal.addEventListener('click', closeInstructionModalFunc);
            logoutBtn.addEventListener('click', showLogoutConfirmation);
            confirmLogout.addEventListener('click', performLogout);
            cancelLogout.addEventListener('click', hideLogoutConfirmation);
            
            // Close modals when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target === feedbackModal) {
                    closeFeedbackModalFunc();
                }
                if (e.target === instructionModal) {
                    closeInstructionModalFunc();
                }
                if (e.target === confirmationModal) {
                    hideLogoutConfirmation();
                }
            });
            
            // Initialize dark mode
            if (localStorage.getItem('darkMode') === 'enabled') {
                document.body.classList.add('dark-mode');
                modeIcon.classList.remove('fa-moon');
                modeIcon.classList.add('fa-sun');
            }
            
            // Create floating particles
            createParticles();
            
            // Check if user is already logged in
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showQuizInterface();
            }
        });
        
        // Create floating particles for background
        function createParticles() {
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');
                
                // Random size and position
                const size = Math.random() * 10 + 5;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.left = `${Math.random() * 100}vw`;
                particle.style.top = `${Math.random() * 100}vh`;
                
                // Random animation duration and delay
                particle.style.animationDuration = `${Math.random() * 20 + 10}s`;
                particle.style.animationDelay = `${Math.random() * 5}s`;
                
                particlesContainer.appendChild(particle);
            }
        }
        
        // Show logout confirmation modal
        function showLogoutConfirmation() {
            confirmationModal.style.display = 'flex';
        }
        
        // Hide logout confirmation modal
        function hideLogoutConfirmation() {
            confirmationModal.style.display = 'none';
        }
        
        // Perform logout
        function performLogout() {
            hideLogoutConfirmation();
            
            currentUser = null;
            localStorage.removeItem('currentUser');
            
            userInfoPanel.style.display = 'none';
            quizContainer.style.display = 'none';
            resultsContainer.style.display = 'none';
            loginSection.style.display = 'flex';
            welcomeAnimation.style.display = 'none';
            
            loginForm.reset();
            
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }
        
        // Show instruction modal
        function showInstructionModal() {
            instructionModal.style.display = 'flex';
        }
        
        // Close instruction modal
        function closeInstructionModalFunc() {
            instructionModal.style.display = 'none';
        }
        
        // Show feedback modal
        function showFeedbackModal() {
            if (currentUser) {
                feedbackName.value = currentUser.name;
                feedbackMobile.value = currentUser.mobile || "Not available";
                feedbackComputer.value = currentUser.computer || "Not available";
            }
            feedbackModal.style.display = 'flex';
            feedbackResult.style.display = 'none';
            feedbackSaving.style.display = 'none';
            feedbackForm.reset();
        }
        
        // Close feedback modal
        function closeFeedbackModalFunc() {
            feedbackModal.style.display = 'none';
        }
        
        // Validate mobile number
        function isValidMobile(mobile) {
            return /^\d{10}$/.test(mobile);
        }
        
        // Validate test code
        function isValidTestCode(testCode) {
            return testCode === '1610';
        }
        
        // Handle login form submission
        function handleLogin(e) {
            e.preventDefault();
            
            const name = document.getElementById('login-name').value;
            const mobile = document.getElementById('login-mobile').value;
            const fatherName = document.getElementById('login-father').value;
            const computer = document.getElementById('login-computer').value;
            const studentClass = document.getElementById('login-class').value;
            const subject = document.getElementById('login-subject').value;
            const testCode = document.getElementById('login-testcode').value;
            
            if (!isValidMobile(mobile)) {
                alert('Please enter a valid 10-digit mobile number');
                return;
            }
            
            if (!isValidTestCode(testCode)) {
                alert('Invalid test code. Please enter the correct test code');
                return;
            }
            
            currentUser = {
                name: name,
                mobile: mobile,
                fatherName: fatherName,
                computer: computer,
                class: studentClass,
                subject: subject,
                testCode: testCode
            };
            
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            
            showQuizInterface();
        }
        
        // Show quiz interface after login
        function showQuizInterface() {
            loginSection.style.display = 'none';
            userInfoPanel.style.display = 'flex';
            quizContainer.style.display = 'block';
            
            displayStudentName.textContent = currentUser.name;
            displayMobile.textContent = currentUser.mobile;
            displayClass.textContent = `${currentUser.class} - ${currentUser.subject}`;
            displayComputer.textContent = `Computer: ${currentUser.computer}`;
            welcomeName.textContent = currentUser.name;
            
            welcomeAnimation.style.display = 'block';
            
            setTimeout(() => {
                welcomeAnimation.style.display = 'none';
            }, 3000);
            
            generateQuiz();
        }
        
        // Toggle dark mode
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            
            if (document.body.classList.contains('dark-mode')) {
                localStorage.setItem('darkMode', 'enabled');
                modeIcon.classList.remove('fa-moon');
                modeIcon.classList.add('fa-sun');
            } else {
                localStorage.setItem('darkMode', 'disabled');
                modeIcon.classList.remove('fa-sun');
                modeIcon.classList.add('fa-moon');
            }
        }
        
        // Generate quiz questions
        function generateQuiz() {
            quizData = class9EnglishQuestions;
            userAnswers = new Array(quizData.length).fill(null);
            visitedQuestions = new Array(quizData.length).fill(false);
            
            currentQuestionIndex = 0;
            visitedQuestions[0] = true;
            
            createReviewButtons();
            updateReviewPanel();
            
            startTimer(60 * 60); // 60 minutes for 50 questions
            
            updateProgressBar();
            displayQuestion();
        }
        
        // Create review buttons for each question
        function createReviewButtons() {
            reviewButtons.innerHTML = '';
            for (let i = 0; i < quizData.length; i++) {
                const button = document.createElement('div');
                button.className = 'review-btn';
                button.textContent = i + 1;
                button.setAttribute('data-index', i);
                
                button.addEventListener('click', () => {
                    currentQuestionIndex = i;
                    visitedQuestions[i] = true;
                    updateProgressBar();
                    updateReviewPanel();
                    displayQuestion();
                });
                
                reviewButtons.appendChild(button);
            }
        }
        
        // Update review panel status
        function updateReviewPanel() {
            const buttons = reviewButtons.querySelectorAll('.review-btn');
            buttons.forEach((button, index) => {
                const i = parseInt(button.getAttribute('data-index'));
                
                button.classList.remove('answered', 'skipped', 'unanswered', 'current');
                
                if (i === currentQuestionIndex) {
                    button.classList.add('current');
                } else if (userAnswers[i] !== null) {
                    button.classList.add('answered');
                } else if (visitedQuestions[i]) {
                    button.classList.add('skipped');
                } else {
                    button.classList.add('unanswered');
                }
            });
        }
        
        // Start quiz timer
        function startTimer(minutes) {
            timeLeft = minutes * 6;
            updateTimerDisplay();
            
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    alert('Time is up! Submitting your quiz now.');
                    showResults();
                } else if (timeLeft <= 300) { // 5 minutes
                    timerElement.classList.add('warning');
                }
            }, 1000);
        }
        
        // Update timer display
        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timerElement.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        }
        
        // Display current question
        function displayQuestion() {
            const question = quizData[currentQuestionIndex];
            
            questionContainer.innerHTML = `
                <div class="question">
                    <h3>Question ${currentQuestionIndex + 1}</h3>
                    <p>${question.question}</p>
                    <div class="options">
                        ${question.options.map((option, index) => `
                            <div class="option ${userAnswers[currentQuestionIndex] === String.fromCharCode(65 + index) ? 'selected' : ''}" 
                                 data-option="${String.fromCharCode(65 + index)}">
                                ${String.fromCharCode(65 + index)}. ${option}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            document.querySelectorAll('.option').forEach(option => {
                option.addEventListener('click', selectOption);
            });
            
            prevBtn.disabled = currentQuestionIndex === 0;
            nextBtn.disabled = false;
            submitQuiz.style.display = currentQuestionIndex === quizData.length - 1 ? 'block' : 'none';
            
            updateReviewPanel();
        }
        
        // Handle option selection
        function selectOption(e) {
            const selectedOption = e.target.getAttribute('data-option');
            userAnswers[currentQuestionIndex] = selectedOption;
            
            document.querySelectorAll('.option').forEach(option => {
                option.classList.remove('selected');
            });
            e.target.classList.add('selected');
            
            updateReviewPanel();
            
            // Auto-advance to next question after selection
            if (currentQuestionIndex < quizData.length - 1) {
                setTimeout(showNextQuestion, 500);
            }
        }
        
        // Show next question
        function showNextQuestion() {
            if (currentQuestionIndex < quizData.length - 1) {
                currentQuestionIndex++;
                visitedQuestions[currentQuestionIndex] = true;
                updateProgressBar();
                updateReviewPanel();
                displayQuestion();
            }
        }
        
        // Show previous question
        function showPreviousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                visitedQuestions[currentQuestionIndex] = true;
                updateProgressBar();
                updateReviewPanel();
                displayQuestion();
            }
        }
        
        // Update progress bar
        function updateProgressBar() {
            const progress = ((currentQuestionIndex + 1) / quizData.length) * 100;
            progressBar.style.width = `${progress}%`;
        }
        
        // Show quiz results
        async function showResults() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            let correctCount = 0;
            quizData.forEach((question, index) => {
                if (userAnswers[index] === question.answer) {
                    correctCount++;
                }
            });
            
            const score = (correctCount / quizData.length) * 100;
            
            scoreElement.textContent = `Score: ${score.toFixed(1)}% (${correctCount}/${quizData.length})`;
            
            let analysisHTML = `
                <h3>Quiz Details:</h3>
                <p><span class="badge">Quiz Type</span> Class 9 English Grammar</p>
                <p><span class="badge">Total Questions</span> ${quizData.length}</p>
                
                <h3 style="margin-top: 15px;">Question Analysis:</h3>
            `;
            
            quizData.forEach((question, index) => {
                const isCorrect = userAnswers[index] === question.answer;
                const userAnswerLetter = userAnswers[index] || 'Not answered';
                const correctAnswerLetter = question.answer;
                
                analysisHTML += `
                    <div class="question-analysis">
                        <p><strong>Question ${index + 1}:</strong> ${question.question}</p>
                        <p class="${isCorrect ? 'correct' : 'incorrect'}">
                            Your answer: ${userAnswerLetter} 
                            ${isCorrect ? ' Correct' : ' Incorrect'}
                        </p>
                        <div class="correct-answer">
                            <strong>Correct Answer:</strong> ${correctAnswerLetter}
                        </div>
                    </div>
                `;
            });
            
            analysisElement.innerHTML = analysisHTML;
            
            // Show saving overlay
            savingOverlay.style.display = 'flex';
            savingStatus.textContent = 'Saving detailed results...';
            
            // Save detailed results to Google Docs (original)
            await saveResultsToGoogleDocs(correctCount);
            
            savingStatus.textContent = 'Saving summary data...';
            
            // Save summary to another Google Docs
            await saveSummaryToGoogleDocs(correctCount, score);
            
            savingStatus.textContent = 'All data saved successfully!';
            
            // Wait a moment to show the success message
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // Hide saving overlay
            savingOverlay.style.display = 'none';
            
            quizContainer.style.display = 'none';
            resultsContainer.style.display = 'block';
        }
        
        // Save results to Google Docs
        async function saveResultsToGoogleDocs(correctCount) {
            if (!currentUser) return;
            
            try {
                savingStatus.textContent = 'Creating detailed document...';
                
                const timestamp = new Date().toLocaleString();
                const studentName = currentUser.name;
                const mobile = currentUser.mobile;
                const fatherName = currentUser.fatherName;
                const computer = currentUser.computer;
                const studentClass = currentUser.class || "Not provided";
                const subject = currentUser.subject || "Not provided";
                const testCode = currentUser.testCode || "Not provided";
                
                // Prepare data for Google Docs
                const data = {
                    timestamp: timestamp,
                    studentName: studentName,
                    mobile: mobile,
                    fatherName: fatherName,
                    computer: computer,
                    class: studentClass,
                    subject: subject,
                    testCode: testCode,
                    correctAnswers: correctCount,
                    totalQuestions: quizData.length,
                    score: ((correctCount / quizData.length) * 100).toFixed(1) + '%',
                    questions: quizData.map((q, i) => ({
                        question: q.question,
                        options: q.options,
                        userAnswer: userAnswers[i] || 'Not answered',
                        correctAnswer: q.answer
                    }))
                };
                
                savingStatus.textContent = 'Sending detailed data...';
                
                // Send data to Google Apps Script
                const response = await fetch(DETAILED_RESULTS_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                console.log('Detailed results saved to Google Docs');
            } catch (error) {
                console.error('Error saving detailed results to Google Docs:', error);
                savingStatus.textContent = 'Error: Could not save detailed results. Saving locally...';
                
                // Fallback: Save to localStorage
                saveResultsToLocalStorage(correctCount);
            }
        }
        
        // Save summary to Google Docs
        async function saveSummaryToGoogleDocs(correctCount, score) {
            if (!currentUser) return;
            
            try {
                savingStatus.textContent = 'Creating summary document...';
                
                const timestamp = new Date().toLocaleString();
                const studentName = currentUser.name;
                const mobile = currentUser.mobile;
                const computer = currentUser.computer;
                const subject = currentUser.subject || "Not provided";
                const testCode = currentUser.testCode || "Not provided";
                
                // Prepare summary data
                const summaryData = {
                    action: 'saveSummary',
                    timestamp: timestamp,
                    studentName: studentName,
                    mobile: mobile,
                    computer: computer,
                    subject: subject,
                    testCode: testCode,
                    score: score.toFixed(1) + '%',
                    correctAnswers: correctCount,
                    totalQuestions: quizData.length,
                    percentage: score.toFixed(1)
                };
                
                savingStatus.textContent = 'Sending summary data...';
                
                // Send summary data to Google Apps Script
                const response = await fetch(SUMMARY_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(summaryData)
                });
                
                console.log('Summary saved to Google Docs');
            } catch (error) {
                console.error('Error saving summary to Google Docs:', error);
                savingStatus.textContent = 'Error: Could not save summary. Saving locally...';
                
                // Fallback: Save summary to localStorage
                saveSummaryToLocalStorage(correctCount, score);
            }
        }
        
        // Save feedback to Google Docs
        async function saveFeedbackToGoogleDocs(feedbackData) {
            try {
                const response = await fetch(FEEDBACK_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(feedbackData)
                });
                
                console.log('Feedback saved to Google Docs');
                return true;
            } catch (error) {
                console.error('Error saving feedback to Google Docs:', error);
                return false;
            }
        }
        
        // Save results to localStorage as fallback
        function saveResultsToLocalStorage(correctCount) {
            if (!currentUser) return;
            
            const timestamp = new Date().toLocaleString();
            const studentName = currentUser.name;
            const mobile = currentUser.mobile;
            const fatherName = currentUser.fatherName;
            const computer = currentUser.computer;
            const studentClass = currentUser.class || "Not provided";
            const subject = currentUser.subject || "Not provided";
            const testCode = currentUser.testCode || "Not provided";
            
            const resultData = {
                timestamp: timestamp,
                studentName: studentName,
                mobile: mobile,
                fatherName: fatherName,
                computer: computer,
                class: studentClass,
                subject: subject,
                testCode: testCode,
                correctAnswers: correctCount,
                totalQuestions: quizData.length,
                score: ((correctCount / quizData.length) * 100).toFixed(1) + '%',
                questions: quizData.map((q, i) => ({
                    question: q.question,
                    options: q.options,
                    userAnswer: userAnswers[i] || 'Not answered',
                    correctAnswer: q.answer
                }))
            };
            
            // Save to localStorage as fallback
            let savedResults = JSON.parse(localStorage.getItem('quizResults')) || [];
            savedResults.push(resultData);
            localStorage.setItem('quizResults', JSON.stringify(savedResults));
            
            console.log('Detailed results saved to localStorage as fallback');
        }
        
        // Save summary to localStorage as fallback
        function saveSummaryToLocalStorage(correctCount, score) {
            if (!currentUser) return;
            
            const timestamp = new Date().toLocaleString();
            const studentName = currentUser.name;
            const mobile = currentUser.mobile;
            const computer = currentUser.computer;
            const subject = currentUser.subject || "Not provided";
            const testCode = currentUser.testCode || "Not provided";
            
            const summaryData = {
                timestamp: timestamp,
                studentName: studentName,
                mobile: mobile,
                computer: computer,
                subject: subject,
                testCode: testCode,
                score: score.toFixed(1) + '%',
                correctAnswers: correctCount,
                totalQuestions: quizData.length,
                percentage: score.toFixed(1)
            };
            
            // Save summary to localStorage as fallback
            let savedSummaries = JSON.parse(localStorage.getItem('quizSummaries')) || [];
            savedSummaries.push(summaryData);
            localStorage.setItem('quizSummaries', JSON.stringify(savedSummaries));
            
            console.log('Summary saved to localStorage as fallback');
        }
        
        // Handle feedback form submission
        async function handleFeedback(e) {
            e.preventDefault();
            
            const message = document.getElementById('feedback-message').value;
            
            if (!message) {
                alert('Please enter your feedback message');
                return;
            }
            
            // Show loading state
            feedbackSaving.style.display = 'block';
            feedbackSubmitBtn.disabled = true;
            
            const feedbackData = {
                name: currentUser.name,
                mobile: currentUser.mobile || "Not available",
                fatherName: currentUser.fatherName || "Not provided",
                computer: currentUser.computer || "Not available",
                message: message,
                timestamp: new Date().toLocaleString()
            };
            
            // Save to Google Docs
            const googleDocsSuccess = await saveFeedbackToGoogleDocs(feedbackData);
            
            // Always save to localStorage as fallback
            let feedbacks = JSON.parse(localStorage.getItem('feedbacks')) || [];
            feedbacks.push(feedbackData);
            localStorage.setItem('feedbacks', JSON.stringify(feedbacks));
            
            // Hide loading state
            feedbackSaving.style.display = 'none';
            feedbackSubmitBtn.disabled = false;
            
            // Show success message
            feedbackResult.style.display = 'block';
            
            feedbackForm.reset();
            
            setTimeout(() => {
                feedbackModal.style.display = 'none';
            }, 2000);
        }
        
        // Class 9 English Grammar Questions (50 questions)
        const class9EnglishQuestions = [
            {
                question: "Jane isn't here yet. I ______ since noon but there is no sign of her.",
                options: ["have waited", "am writing", "wait", "have been waiting"],
                answer: "D"
            },
            {
                question: "I ______ her for several years.",
                options: ["has known", "have known", "knew", "knows"],
                answer: "B"
            },
            {
                question: "Which sentence is in the present perfect tense?",
                options: ["She writes a letter.", "She will write a letter.", "She has written a letter.", "She was writing a letter."],
                answer: "C"
            },
            {
                question: "The children ______ in the field now.",
                options: ["has played", "are playing", "plays", "will had played"],
                answer: "B"
            },
            {
                question: "This road ______ to the post office.",
                options: ["is leading", "leads", "has lead", "lead"],
                answer: "B"
            },
            {
                question: "Fill in the appropriate form of present tense: My mother ______ up early in the morning.",
                options: ["get", "gets", "will be", "shall be"],
                answer: "B"
            },
            {
                question: "Gambling ______ ruined many careers.",
                options: ["is", "was", "has", "have"],
                answer: "C"
            },
            {
                question: "On June 20th, I returned home. I ______ for almost two years.",
                options: ["was away", "have been away", "am away", "had been away"],
                answer: "D"
            },
            {
                question: "Fill with the appropriate form of past tense to form meaningful sentences. He ______ his house seven days ago.",
                options: ["left", "leave", "leaves", "is leaving"],
                answer: "A"
            },
            {
                question: "Put the verbs in brackets into the correct tense - Present Perfect or Simple Past. She ______ (meet) me yesterday.",
                options: ["meets", "met", "meeting", "will meet"],
                answer: "B"
            },
            {
                question: "Fill with the appropriate form of past tense to form meaningful sentences. It ______ raining since morning when you rang me up.",
                options: ["had been", "has been", "have been", "was"],
                answer: "A"
            },
            {
                question: "Before I started the car, all of the passengers ______ their seat belts.",
                options: ["will buckle", "will have buckled", "had buckled", "buckle"],
                answer: "C"
            },
            {
                question: "The movie ______ started when I reached the cinema hall.",
                options: ["has", "have", "had", "had been"],
                answer: "C"
            },
            {
                question: "Fill in the blank with the correct option. I ______ a letter when he came to my house.",
                options: ["am writing", "was writing", "will write", "wrote"],
                answer: "B"
            },
            {
                question: "What tense is used in the sentence: 'She will have completed her project by tomorrow.'",
                options: ["Future Perfect", "Present Perfect", "Past Continuous", "Future Continuous"],
                answer: "A"
            },
            {
                question: "Fill in the blank with the future perfect tense form of the verb given in the bracket. 'Kiaan ______ seats for us.' (save)",
                options: ["ought to save", "should save", "will have saved", "would save"],
                answer: "C"
            },
            {
                question: "Identify the correct form of verb to fill in the blank: 'By this time next year, I ___ my exams.'",
                options: ["will complete", "will have completed", "complete", "have completed"],
                answer: "B"
            },
            {
                question: "Fill in the blank with the correct future tense. The cook ______ cooking food at this time tomorrow.",
                options: ["shall be", "will be", "shall", "will"],
                answer: "B"
            },
            {
                question: "Identify the tense of the emboldened and underlined part of the following sentence: 'The consignment shall be reaching by tomorrow.'",
                options: ["Future Indefinite Tense", "Present Continuous Tense", "Future Perfect Continuous Tense", "Future Continuous Tense"],
                answer: "D"
            },
            {
                question: "When I go and see the doctor this afternoon, I ______ him to take a look at my throat.",
                options: ["will ask", "asked", "will have asked", "ask"],
                answer: "A"
            },
            {
                question: "Identify the tense used in the sentence. 'Her brother will talk to her about that issue.'",
                options: ["Future Indefinite Tense", "Future Perfect Tense", "Present Indefinite Tense", "Present Perfect Tense"],
                answer: "A"
            },
            {
                question: "Choose the sentence that is in the Future Continuous Tense:",
                options: ["I will complete my assignment tomorrow.", "They are going to the market.", "She will be attending the seminar at this time tomorrow.", "We had finished our work."],
                answer: "C"
            },
            {
                question: "Identify the sentence that is in the Future Perfect Tense:",
                options: ["He will study for the test.", "They will have completed the project by next week.", "She is going to buy a new phone", "I will be playing in the garden."],
                answer: "B"
            },
            {
                question: "Which of the following sentences is in the Future Perfect Continuous Tense?",
                options: ["She will have been teaching here for five years next month.", "He will go to the market tomorrow.", "They will study for the exams.", "I am going to complete the assignment."],
                answer: "A"
            },
            {
                question: "Choose the most appropriate modal to fill in the blank. This is a beautiful dress. I ______ buy it.",
                options: ["will", "ought to", "might", "must"],
                answer: "A"
            },
            {
                question: "Choose the most appropriate modal to fill in the blank. She ______ walk when she was just 8 months old.",
                options: ["can", "could", "may", "might"],
                answer: "B"
            },
            {
                question: "Choose the most appropriate modal to fill in the blank. She ______ call her parents at least once a week.",
                options: ["shall", "should", "would", "might"],
                answer: "B"
            },
            {
                question: "Choose the most appropriate modal to fill in the blank. ______ I meet the principal?",
                options: ["Might", "Will", "Would", "Could"],
                answer: "D"
            },
            {
                question: "Choose the most appropriate modal to fill in the blank. During peak hours, it ______ take more than 2 hours to reach Thane from Mumbai.",
                options: ["will", "shall", "might", "have to"],
                answer: "C"
            },
            {
                question: "Choose the most appropriate modal to fill in the blank. You ______ not have done this to me.",
                options: ["would", "should", "shall", "will"],
                answer: "B"
            },
            {
                question: "If you worked harder, you ______ pass the test with little difficulty.",
                options: ["can", "could", "may", "will"],
                answer: "B"
            },
            {
                question: "If I get the visa, I ______ travel to the US in January.",
                options: ["can", "will", "would", "could"],
                answer: "B"
            },
            {
                question: "You ______ finish the job before you go home.",
                options: ["must", "can", "could", "shall"],
                answer: "A"
            },
            {
                question: "We ______ always be true to our words.",
                options: ["can", "could", "should", "would"],
                answer: "C"
            },
            {
                question: "'Call the first witness', said the Judge.",
                options: ["The judge commanded to call the first witness.", "The judge commanded them to call the first witness.", "The judge commanded that the first witness be called.", "The judge commanded the first witness to be called."],
                answer: "B"
            },
            {
                question: "The queen said to her son, 'You must go to the forest and remain there till your father calls you back.'",
                options: ["The queen ordered her son to go to the forest and remain there till his father called him back.", "The queen told her son that he had to go to the forest and remain there till his father called him back.", "The queen told his son that you must go to the forest and remain there till your father called you back.", "The queen told her son to go to the forest and remained there till his father called him back."],
                answer: "A"
            },
            {
                question: "I said to her, 'All your faults will be pardoned if you confess them.'",
                options: ["I told her that all her faults will be pardoned if you confess them.", "I told her that all her faults would be pardoned if she confessed them.", "I told her that all her faults would have to be pardoned if she confessed them.", "I told her that all her faults would have to be pardoned if she confessed them."],
                answer: "B"
            },
            {
                question: "He said to Sita, 'When do you intend to pay back the money you borrowed from me?'",
                options: ["He enquired Sita when did she intend to pay back the money she borrowed from him.", "He enquired Sita when she intended to pay back the money she borrowed from him.", "He enquired Sita when she intended to pay back the money she had borrowed from him.", "He enquired when Sita intended to pay back the money, she borrowed from him."],
                answer: "C"
            },
            {
                question: "'Let's give a party', said Jaya. 'Let's not', said her husband.",
                options: ["Jaya suggested giving a party, but her husband answered in the negative.", "Jaya suggested giving a party, but her husband opposed the idea.", "Jaya suggested giving a party, but her husband contradicted her.", "Jaya suggested giving a party, but her husband refused."],
                answer: "B"
            },
            {
                question: "The old man of Latur said, 'Alas! My only son is dead.'",
                options: ["The old man of Latur exclaimed with sorrow that his only son was dead.", "The old man of Latur told with pain that his only son was dead.", "The old man of Latur expressed with anguish that his only son was dead.", "The old man of Latur sorrowfully narrated that his only son was dead."],
                answer: "A"
            },
            {
                question: "She said to the girl, 'Did you do this?'",
                options: ["She asked the girl that she did that.", "She asked the girl if she did that.", "She asked the girl if she had done that.", "She told the girl that she had done that."],
                answer: "C"
            },
            {
                question: "'Many happy returns of your birthday', we said",
                options: ["We greeted him on his birthday.", "We said that many happy returns of your birthday.", "We wished him many happy returns of his birthday.", "We prayed for many happy returns of his birthday."],
                answer: "C"
            },
            {
                question: "'Doctor', the patient cried, 'please tell me how much time I have.'",
                options: ["The patient pleaded the doctor how much time he will have.", "The patient exclaimed to the doctor that how much time he had.", "The patient pleaded with the doctor to tell him how much time he had.", "The patient cried to the doctor that how much time had he."],
                answer: "C"
            },
            {
                question: "'So, help me, Heaven!' he cried, 'I will never steal again.'",
                options: ["He wanted Heaven to help him so that he would never steal again.", "She exclaimed to heaven that he would never steal again.", "He exclaimed heaven to help him that he would never steal again.", "He called upon heaven to witness his resolve to never steal again."],
                answer: "D"
            },
            {
                question: "There are ______ mangoes in the basket, but none are ripe.",
                options: ["much", "several", "little", "each"],
                answer: "B"
            },
            {
                question: "He spent ______ money that he had on buying the medicine.",
                options: ["all the", "each", "few", "many"],
                answer: "A"
            },
            {
                question: "The teacher gave homework to ______ student in the class.",
                options: ["all", "every", "both", "much"],
                answer: "B"
            },
            {
                question: "There were ______ people at the concert yesterday.",
                options: ["much", "many", "little", "every"],
                answer: "B"
            },
            {
                question: "There is ______ milk left in the fridge. We need to buy some.",
                options: ["few", "little", "many", "each"],
                answer: "B"
            },
            {
                question: "______ book on this shelf belongs to the library.",
                options: ["Each", "Every", "Much", "Many"],
                answer: "A"
            }
        ];
    </script>
</body>
</html>
